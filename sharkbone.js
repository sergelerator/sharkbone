(function(){var h=this,f=h._,b={},k=Array.prototype,e=Object.prototype,g=k.push,l=k.slice,c=k.concat,m=e.toString,a=e.hasOwnProperty,d=k.forEach,q=k.map,p=k.reduce,v=k.reduceRight,u=k.filter,t=k.every,w=k.some,x=k.indexOf,r=k.lastIndexOf,e=Array.isArray,z=Object.keys,B=Function.prototype.bind,j=function(a){return a instanceof j?a:this instanceof j?(this._wrapped=a,void 0):new j(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):h._=
j;j.VERSION="1.4.4";var s=j.each=j.forEach=function(a,c,e){if(null!=a)if(d&&a.forEach===d)a.forEach(c,e);else if(a.length===+a.length)for(var n=0,g=a.length;g>n&&c.call(e,a[n],n,a)!==b;n++);else for(n in a)if(j.has(a,n)&&c.call(e,a[n],n,a)===b)break};j.map=j.collect=function(a,c,d){var b=[];return null==a?b:q&&a.map===q?a.map(c,d):(s(a,function(a,y,e){b[b.length]=c.call(d,a,y,e)}),b)};j.reduce=j.foldl=j.inject=function(a,c,d,b){var e=2<arguments.length;if(null==a&&(a=[]),p&&a.reduce===p)return b&&
(c=j.bind(c,b)),e?a.reduce(c,d):a.reduce(c);if(s(a,function(a,y,n){e?d=c.call(b,d,a,y,n):(d=a,e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");return d};j.reduceRight=j.foldr=function(a,c,d,b){var e=2<arguments.length;if(null==a&&(a=[]),v&&a.reduceRight===v)return b&&(c=j.bind(c,b)),e?a.reduceRight(c,d):a.reduceRight(c);var n=a.length;if(n!==+n)var g=j.keys(a),n=g.length;if(s(a,function(f,k,m){k=g?g[--n]:--n;e?d=c.call(b,d,a[k],k,m):(d=a[k],e=!0)}),!e)throw new TypeError("Reduce of empty array with no initial value");
return d};j.find=j.detect=function(a,c,d){var b;return C(a,function(a,e,y){return c.call(d,a,e,y)?(b=a,!0):void 0}),b};j.filter=j.select=function(a,c,d){var b=[];return null==a?b:u&&a.filter===u?a.filter(c,d):(s(a,function(a,e,y){c.call(d,a,e,y)&&(b[b.length]=a)}),b)};j.reject=function(a,c,d){return j.filter(a,function(a,b,e){return!c.call(d,a,b,e)},d)};j.every=j.all=function(a,c,d){c||(c=j.identity);var e=!0;return null==a?e:t&&a.every===t?a.every(c,d):(s(a,function(a,n,y){return(e=e&&c.call(d,a,
n,y))?void 0:b}),!!e)};var C=j.some=j.any=function(a,c,d){c||(c=j.identity);var e=!1;return null==a?e:w&&a.some===w?a.some(c,d):(s(a,function(a,n,y){return e||(e=c.call(d,a,n,y))?b:void 0}),!!e)};j.contains=j.include=function(a,c){return null==a?!1:x&&a.indexOf===x?-1!=a.indexOf(c):C(a,function(a){return a===c})};j.invoke=function(a,c){var d=l.call(arguments,2),b=j.isFunction(c);return j.map(a,function(a){return(b?c:a[c]).apply(a,d)})};j.pluck=function(a,c){return j.map(a,function(a){return a[c]})};
j.where=function(a,c,d){return j.isEmpty(c)?d?null:[]:j[d?"find":"filter"](a,function(a){for(var d in c)if(c[d]!==a[d])return!1;return!0})};j.findWhere=function(a,c){return j.where(a,c,!0)};j.max=function(a,c,d){if(!c&&j.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!c&&j.isEmpty(a))return-1/0;var b={computed:-1/0,value:-1/0};return s(a,function(a,e,n){e=c?c.call(d,a,e,n):a;e>=b.computed&&(b={value:a,computed:e})}),b.value};j.min=function(a,c,d){if(!c&&j.isArray(a)&&a[0]===
+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!c&&j.isEmpty(a))return 1/0;var b={computed:1/0,value:1/0};return s(a,function(a,e,n){e=c?c.call(d,a,e,n):a;b.computed>e&&(b={value:a,computed:e})}),b.value};j.shuffle=function(a){var c,d=0,b=[];return s(a,function(a){c=j.random(d++);b[d-1]=b[c];b[c]=a}),b};var D=function(a){return j.isFunction(a)?a:function(c){return c[a]}};j.sortBy=function(a,c,d){var b=D(c);return j.pluck(j.map(a,function(a,c,e){return{value:a,index:c,criteria:b.call(d,a,c,
e)}}).sort(function(a,c){var d=a.criteria,b=c.criteria;if(d!==b){if(d>b||void 0===d)return 1;if(b>d||void 0===b)return-1}return a.index<c.index?-1:1}),"value")};var E=function(a,c,d,b){var e={},n=D(c||j.identity);return s(a,function(c,g){var f=n.call(d,c,g,a);b(e,f,c)}),e};j.groupBy=function(a,c,d){return E(a,c,d,function(a,c,d){(j.has(a,c)?a[c]:a[c]=[]).push(d)})};j.countBy=function(a,c,d){return E(a,c,d,function(a,c){j.has(a,c)||(a[c]=0);a[c]++})};j.sortedIndex=function(a,c,d,b){d=null==d?j.identity:
D(d);c=d.call(b,c);for(var e=0,n=a.length;n>e;){var g=e+n>>>1;c>d.call(b,a[g])?e=g+1:n=g}return e};j.toArray=function(a){return a?j.isArray(a)?l.call(a):a.length===+a.length?j.map(a,j.identity):j.values(a):[]};j.size=function(a){return null==a?0:a.length===+a.length?a.length:j.keys(a).length};j.first=j.head=j.take=function(a,c,d){return null==a?void 0:null==c||d?a[0]:l.call(a,0,c)};j.initial=function(a,c,d){return l.call(a,0,a.length-(null==c||d?1:c))};j.last=function(a,c,d){return null==a?void 0:
null==c||d?a[a.length-1]:l.call(a,Math.max(a.length-c,0))};j.rest=j.tail=j.drop=function(a,c,d){return l.call(a,null==c||d?1:c)};j.compact=function(a){return j.filter(a,j.identity)};var F=function(a,c,d){return s(a,function(a){j.isArray(a)?c?g.apply(d,a):F(a,c,d):d.push(a)}),d};j.flatten=function(a,c){return F(a,c,[])};j.without=function(a){return j.difference(a,l.call(arguments,1))};j.uniq=j.unique=function(a,c,d,b){j.isFunction(c)&&(b=d,d=c,c=!1);d=d?j.map(a,d,b):a;var e=[],n=[];return s(d,function(d,
b){(c?b&&n[n.length-1]===d:j.contains(n,d))||(n.push(d),e.push(a[b]))}),e};j.union=function(){return j.uniq(c.apply(k,arguments))};j.intersection=function(a){var c=l.call(arguments,1);return j.filter(j.uniq(a),function(a){return j.every(c,function(c){return 0<=j.indexOf(c,a)})})};j.difference=function(a){var d=c.apply(k,l.call(arguments,1));return j.filter(a,function(a){return!j.contains(d,a)})};j.zip=function(){for(var a=l.call(arguments),c=j.max(j.pluck(a,"length")),d=Array(c),b=0;c>b;b++)d[b]=
j.pluck(a,""+b);return d};j.object=function(a,c){if(null==a)return{};for(var d={},b=0,e=a.length;e>b;b++)c?d[a[b]]=c[b]:d[a[b][0]]=a[b][1];return d};j.indexOf=function(a,c,d){if(null==a)return-1;var b=0,e=a.length;if(d){if("number"!=typeof d)return b=j.sortedIndex(a,c),a[b]===c?b:-1;b=0>d?Math.max(0,e+d):d}if(x&&a.indexOf===x)return a.indexOf(c,d);for(;e>b;b++)if(a[b]===c)return b;return-1};j.lastIndexOf=function(a,c,d){if(null==a)return-1;var b=null!=d;if(r&&a.lastIndexOf===r)return b?a.lastIndexOf(c,
d):a.lastIndexOf(c);for(d=b?d:a.length;d--;)if(a[d]===c)return d;return-1};j.range=function(a,c,d){1>=arguments.length&&(c=a||0,a=0);d=arguments[2]||1;for(var b=Math.max(Math.ceil((c-a)/d),0),e=0,n=Array(b);b>e;)n[e++]=a,a+=d;return n};j.bind=function(a,c){if(a.bind===B&&B)return B.apply(a,l.call(arguments,1));var d=l.call(arguments,2);return function(){return a.apply(c,d.concat(l.call(arguments)))}};j.partial=function(a){var c=l.call(arguments,1);return function(){return a.apply(this,c.concat(l.call(arguments)))}};
j.bindAll=function(a){var c=l.call(arguments,1);return 0===c.length&&(c=j.functions(a)),s(c,function(c){a[c]=j.bind(a[c],a)}),a};j.memoize=function(a,c){var d={};return c||(c=j.identity),function(){var b=c.apply(this,arguments);return j.has(d,b)?d[b]:d[b]=a.apply(this,arguments)}};j.delay=function(a,c){var d=l.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},c)};j.defer=function(a){return j.delay.apply(j,[a,1].concat(l.call(arguments,1)))};j.throttle=function(a,c){var d,b,e,
n,g=0,f=function(){g=new Date;e=null;n=a.apply(d,b)};return function(){var k=new Date,m=c-(k-g);return d=this,b=arguments,0>=m?(clearTimeout(e),e=null,g=k,n=a.apply(d,b)):e||(e=setTimeout(f,m)),n}};j.debounce=function(a,c,d){var b,e;return function(){var n=this,g=arguments,f=d&&!b;return clearTimeout(b),b=setTimeout(function(){b=null;d||(e=a.apply(n,g))},c),f&&(e=a.apply(n,g)),e}};j.once=function(a){var c,d=!1;return function(){return d?c:(d=!0,c=a.apply(this,arguments),a=null,c)}};j.wrap=function(a,
c){return function(){var d=[a];return g.apply(d,arguments),c.apply(this,d)}};j.compose=function(){var a=arguments;return function(){for(var c=arguments,d=a.length-1;0<=d;d--)c=[a[d].apply(this,c)];return c[0]}};j.after=function(a,c){return 0>=a?c():function(){return 1>--a?c.apply(this,arguments):void 0}};j.keys=z||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],d;for(d in a)j.has(a,d)&&(c[c.length]=d);return c};j.values=function(a){var c=[],d;for(d in a)j.has(a,d)&&c.push(a[d]);
return c};j.pairs=function(a){var c=[],d;for(d in a)j.has(a,d)&&c.push([d,a[d]]);return c};j.invert=function(a){var c={},d;for(d in a)j.has(a,d)&&(c[a[d]]=d);return c};j.functions=j.methods=function(a){var c=[],d;for(d in a)j.isFunction(a[d])&&c.push(d);return c.sort()};j.extend=function(a){return s(l.call(arguments,1),function(c){if(c)for(var d in c)a[d]=c[d]}),a};j.pick=function(a){var d={},b=c.apply(k,l.call(arguments,1));return s(b,function(c){c in a&&(d[c]=a[c])}),d};j.omit=function(a){var d=
{},b=c.apply(k,l.call(arguments,1)),e;for(e in a)j.contains(b,e)||(d[e]=a[e]);return d};j.defaults=function(a){return s(l.call(arguments,1),function(c){if(c)for(var d in c)null==a[d]&&(a[d]=c[d])}),a};j.clone=function(a){return j.isObject(a)?j.isArray(a)?a.slice():j.extend({},a):a};j.tap=function(a,c){return c(a),a};var A=function(a,c,d,b){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===c;a instanceof j&&(a=a._wrapped);c instanceof j&&(c=c._wrapped);var e=m.call(a);if(e!=m.call(c))return!1;
switch(e){case "[object String]":return a==c+"";case "[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case "[object Date]":case "[object Boolean]":return+a==+c;case "[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var n=d.length;n--;)if(d[n]==a)return b[n]==c;d.push(a);b.push(c);var n=0,g=!0;if("[object Array]"==e){if(n=a.length,g=n==c.length)for(;n--&&(g=A(a[n],c[n],
d,b)););}else{var e=a.constructor,f=c.constructor;if(e!==f&&(!j.isFunction(e)||!(e instanceof e&&j.isFunction(f)&&f instanceof f)))return!1;for(var k in a)if(j.has(a,k)&&(n++,!(g=j.has(c,k)&&A(a[k],c[k],d,b))))break;if(g){for(k in c)if(j.has(c,k)&&!n--)break;g=!n}}return d.pop(),b.pop(),g};j.isEqual=function(a,c){return A(a,c,[],[])};j.isEmpty=function(a){if(null==a)return!0;if(j.isArray(a)||j.isString(a))return 0===a.length;for(var c in a)if(j.has(a,c))return!1;return!0};j.isElement=function(a){return!(!a||
1!==a.nodeType)};j.isArray=e||function(a){return"[object Array]"==m.call(a)};j.isObject=function(a){return a===Object(a)};s("Arguments Function String Number Date RegExp".split(" "),function(a){j["is"+a]=function(c){return m.call(c)=="[object "+a+"]"}});j.isArguments(arguments)||(j.isArguments=function(a){return!(!a||!j.has(a,"callee"))});"function"!=typeof/./&&(j.isFunction=function(a){return"function"==typeof a});j.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};j.isNaN=function(a){return j.isNumber(a)&&
a!=+a};j.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==m.call(a)};j.isNull=function(a){return null===a};j.isUndefined=function(a){return void 0===a};j.has=function(c,d){return a.call(c,d)};j.noConflict=function(){return h._=f,this};j.identity=function(a){return a};j.times=function(a,c,d){for(var b=Array(a),e=0;a>e;e++)b[e]=c.call(d,e);return b};j.random=function(a,c){return null==c&&(c=a,a=0),a+Math.floor(Math.random()*(c-a+1))};var n={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;",
"'":"&#x27;","/":"&#x2F;"}};n.unescape=j.invert(n.escape);var H={escape:RegExp("["+j.keys(n.escape).join("")+"]","g"),unescape:RegExp("("+j.keys(n.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(a){j[a]=function(c){return null==c?"":(""+c).replace(H[a],function(c){return n[a][c]})}});j.result=function(a,c){if(null==a)return null;var d=a[c];return j.isFunction(d)?d.call(a):d};j.mixin=function(a){s(j.functions(a),function(c){var d=j[c]=a[c];j.prototype[c]=function(){var a=[this._wrapped];
g.apply(a,arguments);a=d.apply(j,a);return this._chain?j(a).chain():a}})};var I=0;j.uniqueId=function(a){var c=++I+"";return a?a+c:c};j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var G=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(a,c,d){var b;d=j.defaults({},d,j.templateSettings);var e=RegExp([(d.escape||G).source,(d.interpolate||G).source,(d.evaluate||
G).source].join("|")+"|$","g"),n=0,g="__p+='";a.replace(e,function(c,d,b,e,f){return g+=a.slice(n,f).replace(K,function(a){return"\\"+J[a]}),d&&(g+="'+\n((__t=("+d+"))==null?'':_.escape(__t))+\n'"),b&&(g+="'+\n((__t=("+b+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),n=f+c.length,c});g+="';\n";d.variable||(g="with(obj||{}){\n"+g+"}\n");g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{b=Function(d.variable||"obj","_",g)}catch(f){throw f.source=
g,f;}if(c)return b(c,j);c=function(a){return b.call(this,a,j)};return c.source="function("+(d.variable||"obj")+"){\n"+g+"}",c};j.chain=function(a){return j(a).chain()};j.mixin(j);s("pop push reverse shift sort splice unshift".split(" "),function(a){var c=k[a];j.prototype[a]=function(){var d=this._wrapped;return c.apply(d,arguments),"shift"!=a&&"splice"!=a||0!==d.length||delete d[0],this._chain?j(d).chain():d}});s(["concat","join","slice"],function(a){var c=k[a];j.prototype[a]=function(){var a=c.apply(this._wrapped,
arguments);return this._chain?j(a).chain():a}});j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(h,f){var b=[],k=[],e=[];h.mixin({gsub:function(b,e,c){e=RegExp(e.source||e,"gi");return e.test(b)?b.replace(e,c):null},plural:function(e,f){b.unshift([e,f])},pluralize:function(g,k,c){var m;if(k!==f)k=Math.round(k),m=1===k?this.singularize(g):this.pluralize(g),m=c?[k,m].join(" "):m;else{if(h(e).include(g))return g;m=g;h(b).detect(function(a){return(a=this.gsub(g,a[0],a[1]))?m=a:!1},this)}return m},singular:function(b,e){k.unshift([b,e])},singularize:function(b){if(h(e).include(b))return b;
var f=b;h(k).detect(function(c){return(c=this.gsub(b,c[0],c[1]))?f=c:!1},this);return f},irregular:function(b,e){this.plural("\\b"+b+"\\b",e);this.singular("\\b"+e+"\\b",b)},uncountable:function(b){e.unshift(b)},resetInflections:function(){b=[];k=[];e=[];this.plural(/$/,"s");this.plural(/s$/,"s");this.plural(/(ax|test)is$/,"$1es");this.plural(/(octop|vir)us$/,"$1i");this.plural(/(octop|vir)i$/,"$1i");this.plural(/(alias|status)$/,"$1es");this.plural(/(bu)s$/,"$1ses");this.plural(/(buffal|tomat)o$/,
"$1oes");this.plural(/([ti])um$/,"$1a");this.plural(/([ti])a$/,"$1a");this.plural(/sis$/,"ses");this.plural(/(?:([^f])fe|([lr])f)$/,"$1$2ves");this.plural(/(hive)$/,"$1s");this.plural(/([^aeiouy]|qu)y$/,"$1ies");this.plural(/(x|ch|ss|sh)$/,"$1es");this.plural(/(matr|vert|ind)(?:ix|ex)$/,"$1ices");this.plural(/([m|l])ouse$/,"$1ice");this.plural(/([m|l])ice$/,"$1ice");this.plural(/^(ox)$/,"$1en");this.plural(/^(oxen)$/,"$1");this.plural(/(quiz)$/,"$1zes");this.singular(/s$/,"");this.singular(/(n)ews$/,
"$1ews");this.singular(/([ti])a$/,"$1um");this.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/,"$1$2sis");this.singular(/(^analy)ses$/,"$1sis");this.singular(/([^f])ves$/,"$1fe");this.singular(/(hive)s$/,"$1");this.singular(/(tive)s$/,"$1");this.singular(/([lr])ves$/,"$1f");this.singular(/([^aeiouy]|qu)ies$/,"$1y");this.singular(/(s)eries$/,"$1eries");this.singular(/(m)ovies$/,"$1ovie");this.singular(/(x|ch|ss|sh)es$/,"$1");this.singular(/([m|l])ice$/,"$1ouse");this.singular(/(bus)es$/,
"$1");this.singular(/(o)es$/,"$1");this.singular(/(shoe)s$/,"$1");this.singular(/(cris|ax|test)es$/,"$1is");this.singular(/(octop|vir)i$/,"$1us");this.singular(/(alias|status)es$/,"$1");this.singular(/^(ox)en/,"$1");this.singular(/(vert|ind)ices$/,"$1ex");this.singular(/(matr)ices$/,"$1ix");this.singular(/(quiz)zes$/,"$1");this.singular(/(database)s$/,"$1");this.irregular("person","people");this.irregular("man","men");this.irregular("child","children");this.irregular("sex","sexes");this.irregular("move",
"moves");this.irregular("cow","kine");h("equipment information rice money species series fish sheep jeans".split(/\s+/)).each(function(b){this.uncountable(b)},this);return this}}.resetInflections())})(_);(function(){var h=this,f=h.Backbone,b=[],k=b.push,e=b.slice,g=b.splice,l;l="undefined"!==typeof exports?exports:h.Backbone={};l.VERSION="0.9.10";var c=h._;!c&&"undefined"!==typeof require&&(c=require("underscore"));l.$=h.jQuery||h.Zepto||h.ender;l.noConflict=function(){h.Backbone=f;return this};l.emulateHTTP=!1;l.emulateJSON=!1;var m=/\s+/,a=function(a,c,d,b){if(!d)return!0;if("object"===typeof d)for(var e in d)a[c].apply(a,[e,d[e]].concat(b));else if(m.test(d)){d=d.split(m);e=0;for(var g=d.length;e<
g;e++)a[c].apply(a,[d[e]].concat(b))}else return!0},d=function(a,c){var d,b=-1,e=a.length;switch(c.length){case 0:for(;++b<e;)(d=a[b]).callback.call(d.ctx);break;case 1:for(;++b<e;)(d=a[b]).callback.call(d.ctx,c[0]);break;case 2:for(;++b<e;)(d=a[b]).callback.call(d.ctx,c[0],c[1]);break;case 3:for(;++b<e;)(d=a[b]).callback.call(d.ctx,c[0],c[1],c[2]);break;default:for(;++b<e;)(d=a[b]).callback.apply(d.ctx,c)}},b=l.Events={on:function(c,d,b){if(!a(this,"on",c,[d,b])||!d)return this;this._events||(this._events=
{});(this._events[c]||(this._events[c]=[])).push({callback:d,context:b,ctx:b||this});return this},once:function(d,b,e){if(!a(this,"once",d,[b,e])||!b)return this;var g=this,f=c.once(function(){g.off(d,f);b.apply(this,arguments)});f._callback=b;this.on(d,f,e);return this},off:function(d,b,e){var g,f,k,m,q,l,j,p;if(!this._events||!a(this,"off",d,[b,e]))return this;if(!d&&!b&&!e)return this._events={},this;m=d?[d]:c.keys(this._events);q=0;for(l=m.length;q<l;q++)if(d=m[q],g=this._events[d]){k=[];if(b||
e){j=0;for(p=g.length;j<p;j++)f=g[j],(b&&b!==f.callback&&b!==f.callback._callback||e&&e!==f.context)&&k.push(f)}this._events[d]=k}return this},trigger:function(c){if(!this._events)return this;var b=e.call(arguments,1);if(!a(this,"trigger",c,b))return this;var g=this._events[c],f=this._events.all;g&&d(g,b);f&&d(f,arguments);return this},listenTo:function(a,d,b){var e=this._listeners||(this._listeners={}),g=a._listenerId||(a._listenerId=c.uniqueId("l"));e[g]=a;a.on(d,"object"===typeof d?this:b,this);
return this},stopListening:function(a,c,d){var b=this._listeners;if(b){if(a)a.off(c,"object"===typeof c?this:d,this),!c&&!d&&delete b[a._listenerId];else{"object"===typeof c&&(d=this);for(var e in b)b[e].off(c,d,this);this._listeners={}}return this}}};b.bind=b.on;b.unbind=b.off;c.extend(l,b);var q=l.Model=function(a,d){var b,e=a||{};this.cid=c.uniqueId("c");this.attributes={};d&&d.collection&&(this.collection=d.collection);d&&d.parse&&(e=this.parse(e,d)||{});if(b=c.result(this,"defaults"))e=c.defaults({},
e,b);this.set(e,d);this.changed={};this.initialize.apply(this,arguments)};c.extend(q.prototype,b,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return l.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,d,b){var e,g,f,k,m,q,l;if(null==a)return this;"object"===typeof a?(g=a,b=d):(g={})[a]=d;b||(b={});
if(!this._validate(g,b))return!1;f=b.unset;k=b.silent;a=[];m=this._changing;this._changing=!0;m||(this._previousAttributes=c.clone(this.attributes),this.changed={});l=this.attributes;q=this._previousAttributes;this.idAttribute in g&&(this.id=g[this.idAttribute]);for(e in g)d=g[e],c.isEqual(l[e],d)||a.push(e),c.isEqual(q[e],d)?delete this.changed[e]:this.changed[e]=d,f?delete l[e]:l[e]=d;if(!k){a.length&&(this._pending=!0);d=0;for(e=a.length;d<e;d++)this.trigger("change:"+a[d],this,l[a[d]],b)}if(m)return this;
if(!k)for(;this._pending;)this._pending=!1,this.trigger("change",this,b);this._changing=this._pending=!1;return this},unset:function(a,d){return this.set(a,void 0,c.extend({},d,{unset:!0}))},clear:function(a){var d={},b;for(b in this.attributes)d[b]=void 0;return this.set(d,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var d,b=!1,e=this._changing?
this._previousAttributes:this.attributes,g;for(g in a)if(!c.isEqual(e[g],d=a[g]))(b||(b={}))[g]=d;return b},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{};void 0===a.parse&&(a.parse=!0);var d=a.success;a.success=function(a,c,b){if(!a.set(a.parse(c,b),b))return!1;d&&d(a,c,b)};return this.sync("read",this,a)},save:function(a,d,b){var e,g,f=this.attributes;
null==a||"object"===typeof a?(e=a,b=d):(e={})[a]=d;if(e&&(!b||!b.wait)&&!this.set(e,b))return!1;b=c.extend({validate:!0},b);if(!this._validate(e,b))return!1;e&&b.wait&&(this.attributes=c.extend({},f,e));void 0===b.parse&&(b.parse=!0);g=b.success;b.success=function(a,d,b){a.attributes=f;var k=a.parse(d,b);b.wait&&(k=c.extend(e||{},k));if(c.isObject(k)&&!a.set(k,b))return!1;g&&g(a,d,b)};a=this.isNew()?"create":b.patch?"patch":"update";"patch"===a&&(b.attrs=e);a=this.sync(a,this,b);e&&b.wait&&(this.attributes=
f);return a},destroy:function(a){a=a?c.clone(a):{};var d=this,b=a.success,e=function(){d.trigger("destroy",d,d.collection,a)};a.success=function(a,c,d){(d.wait||a.isNew())&&e();b&&b(a,c,d)};if(this.isNew())return a.success(this,null,a),!1;var g=this.sync("delete",this,a);a.wait||e();return g},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||A();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},
isNew:function(){return null==this.id},isValid:function(a){return!this.validate||!this.validate(this.attributes,a)},_validate:function(a,d){if(!d.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var b=this.validationError=this.validate(a,d)||null;if(!b)return!0;this.trigger("invalid",this,b,d||{});return!1}});var p=l.Collection=function(a,d){d||(d={});d.model&&(this.model=d.model);void 0!==d.comparator&&(this.comparator=d.comparator);this.models=[];this._reset();this.initialize.apply(this,
arguments);a&&this.reset(a,c.extend({silent:!0},d))};c.extend(p.prototype,b,{model:q,initialize:function(){},toJSON:function(a){return this.map(function(c){return c.toJSON(a)})},sync:function(){return l.sync.apply(this,arguments)},add:function(a,d){a=c.isArray(a)?a.slice():[a];d||(d={});var b,e,f,m,q,l,j,p,h,v;j=[];p=d.at;h=this.comparator&&null==p&&!1!=d.sort;v=c.isString(this.comparator)?this.comparator:null;b=0;for(e=a.length;b<e;b++)(f=this._prepareModel(m=a[b],d))?(q=this.get(f))?d.merge&&(q.set(m===
f?f.attributes:m,d),h&&!l&&q.hasChanged(v)&&(l=!0)):(j.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)):this.trigger("invalid",this,m,d);j.length&&(h&&(l=!0),this.length+=j.length,null!=p?g.apply(this.models,[p,0].concat(j)):k.apply(this.models,j));l&&this.sort({silent:!0});if(d.silent)return this;b=0;for(e=j.length;b<e;b++)(f=j[b]).trigger("add",f,this,d);l&&this.trigger("sort",this,d);return this},remove:function(a,d){a=c.isArray(a)?a.slice():[a];
d||(d={});var b,e,g,f;b=0;for(e=a.length;b<e;b++)if(f=this.get(a[b]))delete this._byId[f.id],delete this._byId[f.cid],g=this.indexOf(f),this.models.splice(g,1),this.length--,d.silent||(d.index=g,f.trigger("remove",f,this,d)),this._removeReference(f);return this},push:function(a,d){a=this._prepareModel(a,d);this.add(a,c.extend({at:this.length},d));return a},pop:function(a){var c=this.at(this.length-1);this.remove(c,a);return c},unshift:function(a,d){a=this._prepareModel(a,d);this.add(a,c.extend({at:0},
d));return a},shift:function(a){var c=this.at(0);this.remove(c,a);return c},slice:function(a,c){return this.models.slice(a,c)},get:function(a){if(null!=a)return this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[a.id||a.cid||a[this._idAttr]||a]},at:function(a){return this.models[a]},where:function(a){return c.isEmpty(a)?[]:this.filter(function(c){for(var d in a)if(a[d]!==c.get(d))return!1;return!0})},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");
a||(a={});c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},pluck:function(a){return c.invoke(this.models,"get",a)},update:function(a,d){d=c.extend({add:!0,merge:!0,remove:!0},d);d.parse&&(a=this.parse(a,d));var b,e,g,f,k=[],m=[],q={};c.isArray(a)||(a=a?[a]:[]);if(d.add&&!d.remove)return this.add(a,d);e=0;for(g=a.length;e<g;e++)b=a[e],f=this.get(b),
d.remove&&f&&(q[f.cid]=!0),(d.add&&!f||d.merge&&f)&&k.push(b);if(d.remove){e=0;for(g=this.models.length;e<g;e++)b=this.models[e],q[b.cid]||m.push(b)}m.length&&this.remove(m,d);k.length&&this.add(k,d);return this},reset:function(a,d){d||(d={});d.parse&&(a=this.parse(a,d));for(var b=0,e=this.models.length;b<e;b++)this._removeReference(this.models[b]);d.previousModels=this.models.slice();this._reset();a&&this.add(a,c.extend({silent:!0},d));d.silent||this.trigger("reset",this,d);return this},fetch:function(a){a=
a?c.clone(a):{};void 0===a.parse&&(a.parse=!0);var d=a.success;a.success=function(a,c,b){a[b.update?"update":"reset"](c,b);d&&d(a,c,b)};return this.sync("read",this,a)},create:function(a,d){d=d?c.clone(d):{};if(!(a=this._prepareModel(a,d)))return!1;d.wait||this.add(a,d);var b=this,e=d.success;d.success=function(a,d,c){c.wait&&b.add(a,c);e&&e(a,d,c)};a.save(null,d);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models.length=
0;this._byId={}},_prepareModel:function(a,d){if(a instanceof q)return a.collection||(a.collection=this),a;d||(d={});d.collection=this;var c=new this.model(a,d);return!c._validate(a,d)?!1:c},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,d,c,b){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(d,b),d&&a==="change:"+d.idAttribute&&(delete this._byId[d.previous(d.idAttribute)],null!=d.id&&(this._byId[d.id]=
d)),this.trigger.apply(this,arguments))},sortedIndex:function(a,d,b){d||(d=this.comparator);var e=c.isFunction(d)?d:function(a){return a.get(d)};return c.sortedIndex(this.models,a,e,b)}});c.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(a){p.prototype[a]=function(){var d=
e.call(arguments);d.unshift(this.models);return c[a].apply(c,d)}});c.each(["groupBy","countBy","sortBy"],function(a){p.prototype[a]=function(d,b){var e=c.isFunction(d)?d:function(a){return a.get(d)};return c[a](this.models,e,b)}});var v=l.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},u=/\((.*?)\)/g,t=/(\(\?)?:\w+/g,w=/\*\w+/g,x=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(v.prototype,b,{initialize:function(){},route:function(a,d,b){c.isRegExp(a)||
(a=this._routeToRegExp(a));b||(b=this[d]);l.history.route(a,c.bind(function(c){c=this._extractParameters(a,c);b&&b.apply(this,c);this.trigger.apply(this,["route:"+d].concat(c));this.trigger("route",d,c);l.history.trigger("route",this,d,c)},this));return this},navigate:function(a,d){l.history.navigate(a,d);return this},_bindRoutes:function(){if(this.routes)for(var a,d=c.keys(this.routes);null!=(a=d.pop());)this.route(a,this.routes[a])},_routeToRegExp:function(a){a=a.replace(x,"\\$&").replace(u,"(?:$1)?").replace(t,
function(a,d){return d?a:"([^/]+)"}).replace(w,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,d){return a.exec(d).slice(1)}});var r=l.History=function(){this.handlers=[];c.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},z=/^[#\/]|\s+$/g,B=/^\/+|\/+$/g,j=/msie [\w.]+/,s=/\/$/;r.started=!1;c.extend(r.prototype,b,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,
d){if(null==a)if(this._hasPushState||!this._wantsHashChange||d){a=this.location.pathname;var c=this.root.replace(s,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(z,"")},start:function(a){if(r.started)throw Error("Backbone.history has already been started");r.started=!0;this.options=c.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||
!this.history||!this.history.pushState);a=this.getFragment();var d=document.documentMode,d=j.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(B,"/");d&&this._wantsHashChange&&(this.iframe=l.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)l.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!d)l.$(window).on("hashchange",this.checkUrl);
else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;d=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!d)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&(d&&a.hash)&&(this.fragment=this.getHash().replace(z,""),this.history.replaceState({},document.title,
this.root+this.fragment+a.search));if(!this.options.silent)return this.loadUrl()},stop:function(){l.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);r.started=!1},route:function(a,d){this.handlers.unshift({route:a,callback:d})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},
loadUrl:function(a){var d=this.fragment=this.getFragment(a);return c.any(this.handlers,function(a){if(a.route.test(d))return a.callback(d),!0})},navigate:function(a,d){if(!r.started)return!1;if(!d||!0===d)d={trigger:d};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[d.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,d.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&
(d.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,d.replace));else return this.location.assign(c);d.trigger&&this.loadUrl(a)}},_updateHash:function(a,d,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+d)):a.hash="#"+d}});l.history=new r;var C=l.View=function(a){this.cid=c.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},D=/^(\S+)\s*(.*)$/,E="model collection el id attributes className tagName events".split(" ");
c.extend(C.prototype,b,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,d){this.$el&&this.undelegateEvents();this.$el=a instanceof l.$?a:l.$(a);this.el=this.$el[0];!1!==d&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=c.result(this,"events"))){this.undelegateEvents();for(var d in a){var b=a[d];c.isFunction(b)||(b=this[a[d]]);
if(!b)throw Error('Method "'+a[d]+'" does not exist');var e=d.match(D),g=e[1],e=e[2],b=c.bind(b,this),g=g+(".delegateEvents"+this.cid);if(""===e)this.$el.on(g,b);else this.$el.on(g,e,b)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=c.extend({},c.result(this,"options"),a));c.extend(this,c.pick(a,E));this.options=a},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));
this.id&&(a.id=c.result(this,"id"));this.className&&(a["class"]=c.result(this,"className"));a=l.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(a,!1)}}});var F={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};l.sync=function(a,d,b){var e=F[a];c.defaults(b||(b={}),{emulateHTTP:l.emulateHTTP,emulateJSON:l.emulateJSON});var g={type:e,dataType:"json"};b.url||(g.url=c.result(d,"url")||A());if(null==b.data&&d&&("create"===a||"update"===a||"patch"===a))g.contentType="application/json",
g.data=JSON.stringify(b.attrs||d.toJSON(b));b.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{});if(b.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){g.type="POST";b.emulateJSON&&(g.data._method=e);var f=b.beforeSend;b.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",e);if(f)return f.apply(this,arguments)}}"GET"!==g.type&&!b.emulateJSON&&(g.processData=!1);var k=b.success;b.success=function(a){k&&k(d,a,b);d.trigger("sync",d,a,b)};
var m=b.error;b.error=function(a){m&&m(d,a,b);d.trigger("error",d,a,b)};a=b.xhr=l.ajax(c.extend(g,b));d.trigger("request",d,a,b);return a};l.ajax=function(){return l.$.ajax.apply(l.$,arguments)};q.extend=p.extend=v.extend=C.extend=r.extend=function(a,d){var b=this,e;e=a&&c.has(a,"constructor")?a.constructor:function(){return b.apply(this,arguments)};c.extend(e,b,d);var g=function(){this.constructor=e};g.prototype=b.prototype;e.prototype=new g;a&&c.extend(e.prototype,a);e.__super__=b.prototype;return e};
var A=function(){throw Error('A "url" property or function must be specified');}}).call(this);(function(h){"function"===typeof define&&define.amd?define(["underscore","jquery","backbone"],h):h(_,$,Backbone)})(function(h,f,b){if(!b)throw"Please include Backbone.js before Backbone.ModelBinder.js";b.ModelBinder=function(b){h.bindAll(this);this._modelSetOptions=b||{}};b.ModelBinder.VERSION="0.1.5";b.ModelBinder.Constants={};b.ModelBinder.Constants.ModelToView="ModelToView";b.ModelBinder.Constants.ViewToModel="ViewToModel";h.extend(b.ModelBinder.prototype,{bind:function(b,e,g,l){this.unbind();
this._model=b;this._rootEl=e;this._modelSetOptions=h.extend({},this._modelSetOptions,l);if(!this._model)throw"model must be specified";if(!this._rootEl)throw"rootEl must be specified";g?(this._attributeBindings=f.extend(!0,{},g),this._initializeAttributeBindings(),this._initializeElBindings()):this._initializeDefaultBindings();this._bindModelToView();this._bindViewToModel()},unbind:function(){this._unbindModelToView();this._unbindViewToModel();this._attributeBindings&&(delete this._attributeBindings,
this._attributeBindings=void 0)},_initializeAttributeBindings:function(){var b,e,g,f;for(b in this._attributeBindings){e=this._attributeBindings[b];if(h.isString(e))g={elementBindings:[{selector:e}]};else if(h.isArray(e))g={elementBindings:e};else if(h.isObject(e))g={elementBindings:[e]};else throw"Unsupported type passed to Model Binder "+g;for(e=0;e<g.elementBindings.length;e++)f=g.elementBindings[e],f.attributeBinding=g;g.attributeName=b;this._attributeBindings[b]=g}},_initializeDefaultBindings:function(){var b,
e,g,l,c;this._attributeBindings={};e=f("[name]",this._rootEl);for(b=0;b<e.length;b++)g=e[b],l=f(g).attr("name"),this._attributeBindings[l]?this._attributeBindings[l].elementBindings.push({attributeBinding:this._attributeBindings[l],boundEls:[g]}):(c={attributeName:l},c.elementBindings=[{attributeBinding:c,boundEls:[g]}],this._attributeBindings[l]=c)},_initializeElBindings:function(){var b,e,g,l,c,m,a;for(b in this._attributeBindings){e=this._attributeBindings[b];for(g=0;g<e.elementBindings.length;g++){l=
e.elementBindings[g];c=""===l.selector?f(this._rootEl):f(l.selector,this._rootEl);if(0===c.length)throw"Bad binding found. No elements returned for binding selector "+l.selector;l.boundEls=[];for(m=0;m<c.length;m++)a=c[m],l.boundEls.push(a)}}},_bindModelToView:function(){this._model.on("change",this._onModelChange,this);this.copyModelAttributesToView()},copyModelAttributesToView:function(b){var e,g;for(e in this._attributeBindings)if(void 0===b||-1!==h.indexOf(b,e))g=this._attributeBindings[e],this._copyModelToView(g)},
_unbindModelToView:function(){this._model&&(this._model.off("change",this._onModelChange),this._model=void 0)},_bindViewToModel:function(){f(this._rootEl).delegate("","change",this._onElChanged);f(this._rootEl).delegate("[contenteditable]","blur",this._onElChanged)},_unbindViewToModel:function(){this._rootEl&&(f(this._rootEl).undelegate("","change",this._onElChanged),f(this._rootEl).undelegate("[contenteditable]","blur",this._onElChanged))},_onElChanged:function(b){var e,g,l;b=f(b.target)[0];e=this._getElBindings(b);
for(g=0;g<e.length;g++)l=e[g],this._isBindingUserEditable(l)&&this._copyViewToModel(l,b)},_isBindingUserEditable:function(b){return void 0===b.elAttribute||"text"===b.elAttribute||"html"===b.elAttribute},_getElBindings:function(b){var e,g,f,c,m,a,d=[];for(e in this._attributeBindings){g=this._attributeBindings[e];for(f=0;f<g.elementBindings.length;f++){c=g.elementBindings[f];for(m=0;m<c.boundEls.length;m++)a=c.boundEls[m],a===b&&d.push(c)}}return d},_onModelChange:function(){var b,e;for(b in this._model.changedAttributes())(e=
this._attributeBindings[b])&&this._copyModelToView(e)},_copyModelToView:function(k){var e,g,l,c,m,a;m=this._model.get(k.attributeName);for(e=0;e<k.elementBindings.length;e++){g=k.elementBindings[e];for(l=0;l<g.boundEls.length;l++)c=g.boundEls[l],c._isSetting||(a=this._getConvertedValue(b.ModelBinder.Constants.ModelToView,g,m),this._setEl(f(c),g,a))}},_setEl:function(b,e,g){e.elAttribute?this._setElAttribute(b,e,g):this._setElValue(b,g)},_setElAttribute:function(f,e,g){switch(e.elAttribute){case "html":f.html(g);
break;case "text":f.text(g);break;case "enabled":f.attr("disabled",!g);break;case "displayed":f[g?"show":"hide"]();break;case "hidden":f[g?"hide":"show"]();break;case "css":f.css(e.cssAttribute,g);break;case "class":var l=this._model.previous(e.attributeBinding.attributeName);h.isUndefined(l)||(l=this._getConvertedValue(b.ModelBinder.Constants.ModelToView,e,l),f.removeClass(l));g&&f.addClass(g);break;default:f.attr(e.elAttribute,g)}},_setElValue:function(b,e){if(b.attr("type"))switch(b.attr("type")){case "radio":b.val()===
e&&b.attr("checked","checked");break;case "checkbox":e?b.attr("checked","checked"):b.removeAttr("checked");break;default:b.val(e)}else b.is("input")||b.is("select")||b.is("textarea")?b.val(e):b.text(e)},_copyViewToModel:function(k,e){var g;e._isSetting||(e._isSetting=!0,this._setModel(k,f(e)),e._isSetting=!1,k.converter&&(g=this._model.get(k.attributeBinding.attributeName),g=this._getConvertedValue(b.ModelBinder.Constants.ModelToView,k,g),this._setEl(f(e),k,g)))},_getElValue:function(b,e){switch(e.attr("type")){case "checkbox":return e.prop("checked")?
!0:!1;default:return void 0!==e.attr("contenteditable")?e.html():e.val()}},_setModel:function(f,e){var g={},l=this._getElValue(f,e),l=this._getConvertedValue(b.ModelBinder.Constants.ViewToModel,f,l);g[f.attributeBinding.attributeName]=l;l=h.extend({},this._modelSetOptions,{changeSource:"ModelBinder"});this._model.set(g,l)},_getConvertedValue:function(b,e,f){e.converter&&(f=e.converter(b,f,e.attributeBinding.attributeName,this._model));return f}});b.ModelBinder.CollectionConverter=function(b){this._collection=
b;if(!this._collection)throw"Collection must be defined";h.bindAll(this,"convert")};h.extend(b.ModelBinder.CollectionConverter.prototype,{convert:function(f,e){return f===b.ModelBinder.Constants.ModelToView?e?e.id:void 0:this._collection.get(e)}});b.ModelBinder.createDefaultBindings=function(b,e,g,l){var c,m,a={};b=f("["+e+"]",b);for(c=0;c<b.length;c++)m=b[c],m=f(m).attr(e),a[m]||(a[m]={selector:"["+e+'="'+m+'"]'},g&&(a[m].converter=g),l&&(a[m].elAttribute=l));return a};b.ModelBinder.combineBindings=
function(b,e){h.each(e,function(e,f){var c={selector:e.selector};e.converter&&(c.converter=e.converter);e.elAttribute&&(c.elAttribute=e.elAttribute);b[f]=b[f]?[b[f],c]:c})};return b.ModelBinder});var is={ie:"Microsoft Internet Explorer"==navigator.appName,java:navigator.javaEnabled(),ns:"Netscape"==navigator.appName,ua:navigator.userAgent.toLowerCase(),version:parseFloat(navigator.appVersion.substr(21))||parseFloat(navigator.appVersion),win:"Win32"==navigator.platform};is.mac=0<=is.ua.indexOf("mac");
0<=is.ua.indexOf("opera")&&(is.ie=is.ns=!1,is.opera=!0);0<=is.ua.indexOf("gecko")&&(is.ie=is.ns=!1,is.gecko=!0);(function(){if(!Backbone)throw"Please include Backbone.js before Backbone.ModelBinder.js";if(!Backbone.ModelBinder)throw"Please include Backbone.ModelBinder.js before Backbone.CollectionBinder.js";Backbone.CollectionBinder=function(h,f){_.bindAll(this);this._elManagerFactory=h;if(!this._elManagerFactory)throw"elManagerFactory must be defined.";this._elManagerFactory.trigger=this.trigger;this._options=f||{}};Backbone.CollectionBinder.VERSION="0.1.1";_.extend(Backbone.CollectionBinder.prototype,Backbone.Events,
{bind:function(h,f){this.unbind();if(!h)throw"collection must be defined";if(!f)throw"parentEl must be defined";this._collection=h;this._elManagerFactory.setParentEl(f);this._onCollectionReset();this._collection.on("add",this._onCollectionAdd,this);this._collection.on("remove",this._onCollectionRemove,this);this._collection.on("reset",this._onCollectionReset,this)},unbind:function(){void 0!==this._collection&&(this._collection.off("add",this._onCollectionAdd),this._collection.off("remove",this._onCollectionRemove),
this._collection.off("reset",this._onCollectionReset));this._removeAllElManagers()},getManagerForEl:function(h){var f,b,k=_.values(this._elManagers);for(f=0;f<k.length;f++)if(b=k[f],b.isElContained(h))return b},getManagerForModel:function(h){var f,b,k=_.values(this._elManagers);for(f=0;f<k.length;f++)if(b=k[f],b.getModel()===h)return b},_onCollectionAdd:function(h){this._elManagers[h.cid]=this._elManagerFactory.makeElManager(h);this._elManagers[h.cid].createEl();this._options.autoSort&&this.sortRootEls()},
_onCollectionRemove:function(h){this._removeElManager(h)},_onCollectionReset:function(){this._removeAllElManagers();this._collection.each(function(h){this._onCollectionAdd(h)},this);this.trigger("elsReset",this._collection)},_removeAllElManagers:function(){_.each(this._elManagers,function(h){h.removeEl();delete this._elManagers[h._model.cid]},this);delete this._elManagers;this._elManagers={}},_removeElManager:function(h){void 0!==this._elManagers[h.cid]&&(this._elManagers[h.cid].removeEl(),delete this._elManagers[h.cid])},
sortRootEls:function(){this._collection.each(function(h,f){var b=this.getManagerForModel(h);if(b){var b=b.getEl(),k=this._elManagerFactory.getParentEl().children();k[f]!==b[0]&&(b.detach(),b.insertBefore(k[f]))}},this)}});Backbone.CollectionBinder.ElManagerFactory=function(h,f){_.bindAll(this);this._elHtml=h;this._bindings=f;if(!_.isString(this._elHtml))throw"elHtml must be a valid html string";};_.extend(Backbone.CollectionBinder.ElManagerFactory.prototype,{setParentEl:function(h){this._parentEl=
h},getParentEl:function(){return this._parentEl},makeElManager:function(h){h={_model:h,createEl:function(){this._el=$(this._elHtml);$(this._parentEl).append(this._el);if(this._bindings)if(_.isString(this._bindings))this._modelBinder=new Backbone.ModelBinder,this._modelBinder.bind(this._model,this._el,Backbone.ModelBinder.createDefaultBindings(this._el,this._bindings));else if(_.isObject(this._bindings))this._modelBinder=new Backbone.ModelBinder,this._modelBinder.bind(this._model,this._el,this._bindings);
else throw"Unsupported bindings type, please use a boolean or a bindings hash";this.trigger("elCreated",this._model,this._el)},removeEl:function(){void 0!==this._modelBinder&&this._modelBinder.unbind();this._el.remove();this.trigger("elRemoved",this._model,this._el)},isElContained:function(f){return this._el===f||0<$(this._el).has(f).length},getModel:function(){return this._model},getEl:function(){return this._el}};_.extend(h,this);return h}});Backbone.CollectionBinder.ViewManagerFactory=function(h){_.bindAll(this);
this._viewCreator=h;if(!_.isFunction(this._viewCreator))throw"viewCreator must be a valid function that accepts a model and returns a backbone view";};_.extend(Backbone.CollectionBinder.ViewManagerFactory.prototype,{setParentEl:function(h){this._parentEl=h},getParentEl:function(){return this._parentEl},makeElManager:function(h){var f={_model:h,createEl:function(){this._view=this._viewCreator(h);$(this._parentEl).append(this._view.render(this._model).el);this.trigger("elCreated",this._model,this._view)},
removeEl:function(){void 0!==this._view.close?this._view.close():(this._view.$el.remove(),console.log("warning, you should implement a close() function for your view, you might end up with zombies"));this.trigger("elRemoved",this._model,this._view)},isElContained:function(b){return this._view.el===b||0<this._view.$el.has(b).length},getModel:function(){return this._model},getView:function(){return this._view},getEl:function(){return this._view.el}};_.extend(f,this);return f}})}).call(this);(function(h){var f,b,k;"undefined"===typeof window?(f=require("underscore"),b=require("backbone"),k=module.exports=b):(f=window._,b=window.Backbone,k=window);b.Relational={showWarnings:!0};b.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw Error("All permits released");this._permitsUsed--},isLocked:function(){return 0<
this._permitsUsed},setAvailablePermits:function(a){if(this._permitsUsed>a)throw Error("Available permits cannot be less than used permits");this._permitsAvailable=a}};b.BlockingQueue=function(){this._queue=[]};f.extend(b.BlockingQueue.prototype,b.Semaphore,{_queue:null,add:function(a){this.isBlocked()?this._queue.push(a):a()},process:function(){for(;this._queue&&this._queue.length;)this._queue.shift()()},block:function(){this.acquire()},unblock:function(){this.release();this.isBlocked()||this.process()},
isBlocked:function(){return this.isLocked()}});b.Relational.eventQueue=new b.BlockingQueue;b.Store=function(){this._collections=[];this._reverseRelations=[];this._orphanRelations=[];this._subModels=[];this._modelScopes=[k]};f.extend(b.Store.prototype,b.Events,{initializeRelation:function(a,d){var c=!f.isString(d.type)?d.type:b[d.type]||this.getObjectByName(d.type);c&&c.prototype instanceof b.Relation?new c(a,d):b.Relational.showWarnings&&"undefined"!==typeof console&&console.warn("Relation=%o; missing or invalid type!",
d)},addModelScope:function(a){this._modelScopes.push(a)},addSubModels:function(a,d){this._subModels.push({superModelType:d,subModels:a})},setupSuperModel:function(a){f.find(this._subModels,function(d){return f.find(d.subModels||[],function(c,b){var e=this.getObjectByName(c);if(a===e)return d.superModelType._subModels[b]=a,a._superModel=d.superModelType,a._subModelTypeValue=b,a._subModelTypeAttribute=d.superModelType.prototype.subModelTypeAttribute,!0},this)},this)},addReverseRelation:function(a){!f.any(this._reverseRelations,
function(d){return f.all(a||[],function(a,c){return a===d[c]})})&&(a.model&&a.type)&&(this._reverseRelations.push(a),this._addRelation(a.model,a),this.retroFitRelation(a))},addOrphanRelation:function(a){!f.any(this._orphanRelations,function(d){return f.all(a||[],function(a,c){return a===d[c]})})&&(a.model&&a.type)&&this._orphanRelations.push(a)},processOrphanRelations:function(){f.each(this._orphanRelations.slice(0),function(a){b.Relational.store.getObjectByName(a.relatedModel)&&(this.initializeRelation(null,
a),this._orphanRelations=f.without(this._orphanRelations,a))},this)},_addRelation:function(a,d){a.prototype.relations||(a.prototype.relations=[]);a.prototype.relations.push(d);f.each(a._subModels||[],function(a){this._addRelation(a,d)},this)},retroFitRelation:function(a){var d=this.getCollection(a.model,!1);d&&d.each(function(d){d instanceof a.model&&new a.type(d,a)},this)},getCollection:function(a,d){a instanceof b.RelationalModel&&(a=a.constructor);for(var c=a;c._superModel;)c=c._superModel;var e=
f.findWhere(this._collections,{model:c});!e&&!1!==d&&(e=this._createCollection(c));return e},getObjectByName:function(a){var d=a.split("."),c=null;f.find(this._modelScopes,function(a){if((c=f.reduce(d||[],function(a,d){return a?a[d]:h},a))&&c!==a)return!0},this);return c},_createCollection:function(a){var d;a instanceof b.RelationalModel&&(a=a.constructor);a.prototype instanceof b.RelationalModel&&(d=new b.Collection,d.model=a,this._collections.push(d));return d},resolveIdForItem:function(a,d){var c=
f.isString(d)||f.isNumber(d)?d:null;null===c&&(d instanceof b.RelationalModel?c=d.id:f.isObject(d)&&(c=d[a.prototype.idAttribute]));!c&&0!==c&&(c=null);return c},find:function(a,d){var c=this.resolveIdForItem(a,d),b=this.getCollection(a);return b&&(c=b.get(c),c instanceof a)?c:null},register:function(a){var d=this.getCollection(a);if(d){if(d.get(a))throw b.Relational.showWarnings&&"undefined"!==typeof console&&console.warn("Duplicate id! Old RelationalModel:%o, New RelationalModel:%o",d.get(a),a),
Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!");var c=a.collection;d.add(a);this.listenTo(a,"destroy",this.unregister,this);a.collection=c}},update:function(a){var d=this.getCollection(a);d._onModelEvent("change:"+a.idAttribute,a,d)},unregister:function(a){this.stopListening(a,"destroy",this.unregister);var d=this.getCollection(a);d&&d.remove(a)},reset:function(){this.stopListening();this._collections=[];this._subModels=[];this._modelScopes=[k]}});b.Relational.store=
new b.Store;b.Relation=function(a,d){this.instance=a;d=f.isObject(d)?d:{};this.reverseRelation=f.defaults(d.reverseRelation||{},this.options.reverseRelation);this.options=f.defaults(d,this.options,b.Relation.prototype.options);this.reverseRelation.type=!f.isString(this.reverseRelation.type)?this.reverseRelation.type:b[this.reverseRelation.type]||b.Relational.store.getObjectByName(this.reverseRelation.type);this.key=this.options.key;this.keySource=this.options.keySource||this.key;this.keyDestination=
this.options.keyDestination||this.keySource||this.key;this.model=this.options.model||this.instance.constructor;this.relatedModel=this.options.relatedModel;f.isString(this.relatedModel)&&(this.relatedModel=b.Relational.store.getObjectByName(this.relatedModel));if(this.checkPreconditions()&&(!this.options.isAutoRelation&&(this.reverseRelation.type&&this.reverseRelation.key)&&b.Relational.store.addReverseRelation(f.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},
this.reverseRelation)),a)){var c=this.keySource;c!==this.key&&"object"===typeof this.instance.get(this.key)&&(c=this.key);f.bindAll(this,"destroy","_relatedModelAdded","_relatedModelRemoved");this.setKeyContents(this.instance.get(c));this.keySource!==this.key&&this.instance.unset(this.keySource,{silent:!0});this.instance._relations.push(this);this.initialize();this.options.autoFetch&&this.instance.fetchRelated(this.key,f.isObject(this.options.autoFetch)?this.options.autoFetch:{});this.instance.on("destroy",
this.destroy);b.Relational.store.getCollection(this.relatedModel).on("relational:add",this._relatedModelAdded).on("relational:remove",this._relatedModelRemoved)}};b.Relation.extend=b.Model.extend;f.extend(b.Relation.prototype,b.Events,b.Semaphore,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1},instance:null,key:null,keyContents:null,relatedModel:null,reverseRelation:null,related:null,_relatedModelAdded:function(a,d,c){var b=this;a.queue(function(){b.tryAddRelated(a,c)})},
_relatedModelRemoved:function(a,d,c){this.removeRelated(a,c)},checkPreconditions:function(){var a=this.instance,d=this.key,c=this.model,e=this.relatedModel,g=b.Relational.showWarnings&&"undefined"!==typeof console;return!c||!d||!e?(g&&console.warn("Relation=%o; no model, key or relatedModel (%o, %o, %o)",this,c,d,e),!1):!(c.prototype instanceof b.RelationalModel)?(g&&console.warn("Relation=%o; model does not inherit from Backbone.RelationalModel (%o)",this,a),!1):!(e.prototype instanceof b.RelationalModel)?
(g&&console.warn("Relation=%o; relatedModel does not inherit from Backbone.RelationalModel (%o)",this,e),!1):this instanceof b.HasMany&&this.reverseRelation.type===b.HasMany?(g&&console.warn("Relation=%o; relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1):a&&a._relations.length&&f.any(a._relations||[],function(a){var c=this.reverseRelation.key&&a.reverseRelation.key;return a.relatedModel===e&&a.key===d&&(!c||this.reverseRelation.key===a.reverseRelation.key)},this)?(g&&console.warn("Relation=%o between instance=%o.%s and relatedModel=%o.%s already exists",
this,a,d,e,this.reverseRelation.key),!1):!0},setRelated:function(a){this.related=a;this.instance.acquire();this.instance.attributes[this.key]=a;this.instance.release()},_isReverseRelation:function(a){return a.instance instanceof this.relatedModel&&this.reverseRelation.key===a.key&&this.key===a.reverseRelation.key},getReverseRelations:function(a){var d=[];a=!f.isUndefined(a)?[a]:this.related&&(this.related.models||[this.related]);f.each(a||[],function(a){f.each(a.getRelations()||[],function(a){this._isReverseRelation(a)&&
d.push(a)},this)},this);return d},sanitizeOptions:function(a){a=a?f.clone(a):{};a.silent&&(a.silentChange=!0,delete a.silent);return a},unsanitizeOptions:function(a){a=a?f.clone(a):{};a.silentChange&&(a.silent=!0,delete a.silentChange);return a},destroy:function(){this.instance.off("destroy",this.destroy);b.Relational.store.getCollection(this.relatedModel).off("relational:add",this._relatedModelAdded).off("relational:remove",this._relatedModelRemoved);this instanceof b.HasOne?this.setRelated(null):
this instanceof b.HasMany&&this.setRelated(this._prepareCollection());f.each(this.getReverseRelations()||[],function(a){a.removeRelated(this.instance)},this)}});b.HasOne=b.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(){f.bindAll(this,"onChange");this.instance.on("relational:change:"+this.key,this.onChange);var a=this.findRelated();this.setRelated(a);f.each(this.getReverseRelations()||[],function(a){a.addRelated(this.instance)},this)},findRelated:function(a){var d=
null;if(this.keyContents instanceof this.relatedModel)d=this.keyContents;else if(this.keyContents||0===this.keyContents)a=f.defaults({create:this.options.createModels},a),d=this.relatedModel.findOrCreate(this.keyContents,a);return d},setKeyContents:function(a){this.keyContents=a;this.keyId=b.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(a,d,c){if(!this.isLocked()){this.acquire();c=this.sanitizeOptions(c);var e=f.isUndefined(c._related);a=e?this.related:c._related;
e&&(this.setKeyContents(d),this.keyContents instanceof this.relatedModel?this.related=this.keyContents:this.keyContents?(d=this.findRelated(c),this.setRelated(d)):this.setRelated(null));a&&this.related!==a&&f.each(this.getReverseRelations(a)||[],function(a){a.removeRelated(this.instance,c)},this);f.each(this.getReverseRelations()||[],function(a){a.addRelated(this.instance,c)},this);if(!c.silentChange&&this.related!==a){var g=this;b.Relational.eventQueue.add(function(){g.instance.trigger("update:"+
g.key,g.instance,g.related,c)})}this.release()}},tryAddRelated:function(a,d){if(!this.related&&(this.keyId||0===this.keyId)&&a.id===this.keyId)d=this.sanitizeOptions(d),this.addRelated(a,d)},addRelated:function(a){if(a!==this.related){var d=this.related||null;this.setRelated(a);this.onChange(this.instance,a,{_related:d})}},removeRelated:function(a){if(this.related&&a===this.related){var d=this.related||null;this.setRelated(null);this.onChange(this.instance,a,{_related:d})}}});b.HasMany=b.Relation.extend({collectionType:null,
options:{reverseRelation:{type:"HasOne"},collectionType:b.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(){f.bindAll(this,"onChange","handleAddition","handleRemoval","handleReset");this.instance.on("relational:change:"+this.key,this.onChange);this.collectionType=this.options.collectionType;f.isString(this.collectionType)&&(this.collectionType=b.Relational.store.getObjectByName(this.collectionType));if(!this.collectionType.prototype instanceof b.Collection)throw Error("`collectionType` must inherit from Backbone.Collection");
this.keyContents instanceof b.Collection?this.setRelated(this._prepareCollection(this.keyContents)):this.setRelated(this._prepareCollection());this.findRelated({silent:!0})},_getCollectionOptions:function(){return f.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions},_prepareCollection:function(a){this.related&&this.related.off("relational:add",this.handleAddition).off("relational:remove",this.handleRemoval).off("relational:reset",
this.handleReset);if(!a||!(a instanceof b.Collection))a=new this.collectionType(null,this._getCollectionOptions());a.model=this.relatedModel;if(this.options.collectionKey){var d=!0===this.options.collectionKey?this.options.reverseRelation.key:this.options.collectionKey;a[d]&&a[d]!==this.instance?b.Relational.showWarnings&&"undefined"!==typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,d,this.options.collectionKey):d&&(a[d]=this.instance)}a.on("relational:add",
this.handleAddition).on("relational:remove",this.handleRemoval).on("relational:reset",this.handleReset);return a},findRelated:function(a){if(this.keyContents){var d=[];this.keyContents instanceof b.Collection?d=this.keyContents.models:f.each(this.keyContents||[],function(c){var b=null;if(c instanceof this.relatedModel)b=c;else if(c||0===c)b=f.defaults({create:this.options.createModels},a),b=this.relatedModel.findOrCreate(c,b);b&&!this.related.get(b)&&d.push(b)},this);d.length&&(a=this.unsanitizeOptions(a),
this.related.add(d,a))}},setKeyContents:function(a){this.keyContents=a instanceof b.Collection?a:null;this.keyIds=[];this.keyContents||(this.keyContents=f.isArray(a)?a:[a],this.keyIds=f.map(this.keyContents,function(a){return b.Relational.store.resolveIdForItem(this.relatedModel,a)},this))},onChange:function(a,d,c){c=this.sanitizeOptions(c);this.setKeyContents(d);a=null;if(this.keyContents instanceof b.Collection)this._prepareCollection(this.keyContents),a=this.keyContents;else{var e=[];f.each(this.keyContents,
function(a){(a=this.relatedModel.findOrCreate(a,f.extend(c,{create:this.options.createModels})))&&e.push(a)},this);a=this.related instanceof b.Collection?this.related:this._prepareCollection();a.update(e,c)}this.setRelated(a);var g=this;b.Relational.eventQueue.add(function(){!c.silentChange&&g.instance.trigger("update:"+g.key,g.instance,g.related,c)})},tryAddRelated:function(a,d){!this.related.get(a)&&f.contains(this.keyIds,a.id)&&(d=this.sanitizeOptions(d),this.related.add(a,d))},handleAddition:function(a,
d,c){if(a instanceof b.Model){c=this.sanitizeOptions(c);f.each(this.getReverseRelations(a)||[],function(a){a.addRelated(this.instance,c)},this);var e=this;b.Relational.eventQueue.add(function(){!c.silentChange&&e.instance.trigger("add:"+e.key,a,e.related,c)})}},handleRemoval:function(a,c,e){if(a instanceof b.Model){e=this.sanitizeOptions(e);f.each(this.getReverseRelations(a)||[],function(a){a.removeRelated(this.instance,e)},this);var g=this;b.Relational.eventQueue.add(function(){!e.silentChange&&
g.instance.trigger("remove:"+g.key,a,g.related,e)})}},handleReset:function(a,c){c=this.sanitizeOptions(c);var e=this;b.Relational.eventQueue.add(function(){!c.silentChange&&e.instance.trigger("reset:"+e.key,e.related,c)})},addRelated:function(a,c){var b=this;c=this.unsanitizeOptions(c);a.queue(function(){b.related&&!b.related.get(a)&&b.related.add(a,c)})},removeRelated:function(a,c){c=this.unsanitizeOptions(c);this.related.get(a)&&this.related.remove(a,c)}});b.RelationalModel=b.Model.extend({relations:null,
_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(a,c){var e=this;if(c&&c.collection){this._deferProcessing=!0;var g=function(a){a===e&&(e._deferProcessing=!1,e.processQueue(),c.collection.off("relational:add",g))};c.collection.on("relational:add",g);f.defer(function(){g(e)})}b.Relational.store.processOrphanRelations();this._queue=new b.BlockingQueue;this._queue.block();b.Relational.eventQueue.block();b.Model.apply(this,
arguments);b.Relational.eventQueue.unblock()},trigger:function(a){if(5<a.length&&"change"===a.substr(0,6)){var c=this,e=arguments;b.Relational.eventQueue.add(function(){b.Model.prototype.trigger.apply(c,e)})}else b.Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(){this.acquire();this._relations=[];f.each(this.relations||[],function(a){b.Relational.store.initializeRelation(this,a)},this);this._isInitialized=!0;this.release();this.processQueue()},updateRelations:function(a){this._isInitialized&&
!this.isLocked()&&f.each(this._relations||[],function(c){var b=this.attributes[c.keySource]||this.attributes[c.key];c.related!==b&&this.trigger("relational:change:"+c.key,this,b,a||{})},this)},queue:function(a){this._queue.add(a)},processQueue:function(){this._isInitialized&&(!this._deferProcessing&&this._queue.isBlocked())&&this._queue.unblock()},getRelation:function(a){return f.findWhere(this._relations,{key:a})},getRelations:function(){return this._relations},fetchRelated:function(a,c,e){c=f.extend({update:!0,
remove:!1},c);var g,m=[],k=this.getRelation(a);if((a=(a=k&&k.keyContents)&&f.select(f.isArray(a)?a:[a],function(a){a=b.Relational.store.resolveIdForItem(k.relatedModel,a);return!f.isNull(a)&&(e||!b.Relational.store.find(k.relatedModel,a))},this))&&a.length){var l=f.map(a,function(a){if(f.isObject(a))a=k.relatedModel.findOrCreate(a,c);else{var b={};b[k.relatedModel.prototype.idAttribute]=a;a=k.relatedModel.findOrCreate(b,c)}return a},this);k.related instanceof b.Collection&&f.isFunction(k.related.url)&&
(g=k.related.url(l));g&&g!==k.related.url()?(g=f.defaults({error:function(){var a=arguments;f.each(l||[],function(b){b.trigger("destroy",b,b.collection,c);c.error&&c.error.apply(b,a)})},url:g},c),m=[k.related.fetch(g)]):m=f.map(l||[],function(a){var b=f.defaults({error:function(){a.trigger("destroy",a,a.collection,c);c.error&&c.error.apply(a,arguments)}},c);return a.fetch(b)},this)}return m},get:function(a){var c=b.Model.prototype.get.call(this,a);if(!this.dotNotation||-1===a.indexOf("."))return c;
var e=a.split("."),e=f.reduce(e,function(a,c){if(!(a instanceof b.Model))throw Error("Attribute must be an instanceof Backbone.Model. Is: "+a+", currentSplit: "+c);return b.Model.prototype.get.call(a,c)},this);if(c!==h&&e!==h)throw Error("Ambiguous result for '"+a+"'. direct result: "+c+", dotNotation: "+e);return c||e},set:function(a,c,e){b.Relational.eventQueue.block();var g;f.isObject(a)||null==a?(g=a,e=c):(g={},g[a]=c);var m=b.Model.prototype.set.apply(this,arguments);!this._isInitialized&&!this.isLocked()?
(this.constructor.initializeModelHierarchy(),b.Relational.store.register(this),this.initializeRelations()):g&&this.idAttribute in g&&b.Relational.store.update(this);g&&this.updateRelations(e);b.Relational.eventQueue.unblock();return m},unset:function(a,c){b.Relational.eventQueue.block();var e=b.Model.prototype.unset.apply(this,arguments);this.updateRelations(c);b.Relational.eventQueue.unblock();return e},clear:function(a){b.Relational.eventQueue.block();var c=b.Model.prototype.clear.apply(this,arguments);
this.updateRelations(a);b.Relational.eventQueue.unblock();return c},clone:function(){var a=f.clone(this.attributes);f.isUndefined(a[this.idAttribute])||(a[this.idAttribute]=null);f.each(this.getRelations()||[],function(c){delete a[c.key]});return new this.constructor(a)},toJSON:function(a){if(this.isLocked())return this.id;this.acquire();var c=b.Model.prototype.toJSON.call(this,a);this.constructor._superModel&&!(this.constructor._subModelTypeAttribute in c)&&(c[this.constructor._subModelTypeAttribute]=
this.constructor._subModelTypeValue);f.each(this._relations||[],function(e){var g=c[e.key];if(!0===e.options.includeInJSON)c[e.keyDestination]=g&&f.isFunction(g.toJSON)?g.toJSON(a):null;else if(f.isString(e.options.includeInJSON))c[e.keyDestination]=g instanceof b.Collection?g.pluck(e.options.includeInJSON):g instanceof b.Model?g.get(e.options.includeInJSON):null;else if(f.isArray(e.options.includeInJSON)){var m=[];g instanceof b.Collection?(g.each(function(a){var c={};f.each(e.options.includeInJSON,
function(d){c[d]=a.get(d)});m.push(c)}),c[e.keyDestination]=m):g instanceof b.Model?(f.each(e.options.includeInJSON,function(a){m[a]=g.get(a)}),c[e.keyDestination]=m):c[e.keyDestination]=null}else delete c[e.key];e.keyDestination!==e.key&&delete c[e.key]});this.release();return c}},{setup:function(){this.prototype.relations=(this.prototype.relations||[]).slice(0);this._subModels={};this._superModel=null;this.prototype.hasOwnProperty("subModelTypes")?b.Relational.store.addSubModels(this.prototype.subModelTypes,
this):this.prototype.subModelTypes=null;f.each(this.prototype.relations||[],function(a){a.model||(a.model=this);if(a.reverseRelation&&a.model===this){var c=!0;f.isString(a.relatedModel)&&(c=(c=b.Relational.store.getObjectByName(a.relatedModel))&&c.prototype instanceof b.RelationalModel);c?b.Relational.store.initializeRelation(null,a):f.isString(a.relatedModel)&&b.Relational.store.addOrphanRelation(a)}},this);return this},build:function(a,c){var b=this;this.initializeModelHierarchy();if(this._subModels&&
this.prototype.subModelTypeAttribute in a){var e=this._subModels[a[this.prototype.subModelTypeAttribute]];e&&(b=e)}return new b(a,c)},initializeModelHierarchy:function(){if(f.isUndefined(this._superModel)||f.isNull(this._superModel))if(b.Relational.store.setupSuperModel(this),this._superModel){if(this._superModel.prototype.relations&&!f.any(this.prototype.relations||[],function(a){return a.model&&a.model!==this},this))this.prototype.relations=this._superModel.prototype.relations.concat(this.prototype.relations)}else this._superModel=
!1;this.prototype.subModelTypes&&f.keys(this.prototype.subModelTypes).length!==f.keys(this._subModels).length&&f.each(this.prototype.subModelTypes||[],function(a){(a=b.Relational.store.getObjectByName(a))&&a.initializeModelHierarchy()})},findOrCreate:function(a,c){c||(c={});var e=f.isObject(a)&&this.prototype.parse?this.prototype.parse(a):a,g=b.Relational.store.find(this,e);f.isObject(a)&&(g&&!1!==c.merge?g.set(e,c):!g&&!1!==c.create&&(g=this.build(a,c)));return g}});f.extend(b.RelationalModel.prototype,
b.Semaphore);b.Collection.prototype.__prepareModel=b.Collection.prototype._prepareModel;b.Collection.prototype._prepareModel=function(a,c){var e;if(a instanceof b.Model)a.collection||(a.collection=this),e=a;else if(c||(c={}),c.collection=this,(e="undefined"!==typeof this.model.findOrCreate?this.model.findOrCreate(a,c):new this.model(a,c))&&e.isNew()&&!e._validate(a,c))this.trigger("invalid",this,a,c),e=!1;return e};var e=b.Collection.prototype.__add=b.Collection.prototype.add;b.Collection.prototype.add=
function(a,c){if(!(this.model.prototype instanceof b.RelationalModel))return e.apply(this,arguments);a=f.isArray(a)?a.slice():[a];c=f.extend({merge:!1},c);var g=[],m=[];f.each(a,function(a){a instanceof b.Model||(a=b.Collection.prototype._prepareModel.call(this,a,c));a&&(m.push(a),!this.get(a)&&!this.get(a.cid)?g.push(a):null!=a.id&&(this._byId[a.id]=a))},this);e.call(this,m,c);f.each(g,function(a){(this.get(a)||this.get(a.cid))&&this.trigger("relational:add",a,this,c)},this);return this};var g=b.Collection.prototype.__remove=
b.Collection.prototype.remove;b.Collection.prototype.remove=function(a,c){if(!(this.model.prototype instanceof b.RelationalModel))return g.apply(this,arguments);a=f.isArray(a)?a.slice():[a];c||(c={});var e=[];f.each(a,function(a){(a=this.get(a)||this.get(a.cid))&&e.push(a)},this);e.length&&(g.call(this,e,c),f.each(e,function(a){this.trigger("relational:remove",a,this,c)},this));return this};var l=b.Collection.prototype.__reset=b.Collection.prototype.reset;b.Collection.prototype.reset=function(a,c){l.call(this,
a,c);this.model.prototype instanceof b.RelationalModel&&this.trigger("relational:reset",this,c);return this};var c=b.Collection.prototype.__sort=b.Collection.prototype.sort;b.Collection.prototype.sort=function(a){c.call(this,a);this.model.prototype instanceof b.RelationalModel&&this.trigger("relational:reset",this,a);return this};var m=b.Collection.prototype.__trigger=b.Collection.prototype.trigger;b.Collection.prototype.trigger=function(a){if(!(this.model.prototype instanceof b.RelationalModel))return m.apply(this,
arguments);if("add"===a||"remove"===a||"reset"===a){var c=this,e=arguments;"add"===a&&(e=f.toArray(e),f.isObject(e[3])&&(e[3]=f.clone(e[3])));b.Relational.eventQueue.add(function(){m.apply(c,e)})}else m.apply(this,arguments);return this};b.RelationalModel.extend=function(a,c){var e=b.Model.extend.apply(this,arguments);e.setup(this);return e}})();Backbone.Paginator=function(h,f,b){var k={version:"<%= pkg.version %>"};k.clientPager=h.Collection.extend({useDiacriticsPlugin:!0,useLevenshteinPlugin:!0,sortColumn:"",sortDirection:"desc",lastSortColumn:"",fieldFilterRules:[],lastFieldFilterRules:[],filterFields:"",filterExpression:"",lastFilterExpression:"",defaults_ui:{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4},initialize:function(){this.on("add",this.addModel,this);this.on("remove",this.removeModel,this);this.setDefaults()},
setDefaults:function(){var b=f.defaults(this.paginator_ui,this.defaults_ui);f.defaults(this,b)},addModel:function(b){this.origModels.push(b)},removeModel:function(b){b=f.indexOf(this.origModels,b);this.origModels.splice(b,1)},sync:function(e,g,k){var c=this;this.setDefaults();var m={};f.each(f.result(c,"server_api"),function(a,d){f.isFunction(a)&&(a=f.bind(a,c),a=a());m[d]=a});var a=f.clone(c.paginator_core);f.each(a,function(d,b){f.isFunction(d)&&(d=f.bind(d,c),d=d());a[b]=d});a=f.defaults(a,{timeout:25E3,
cache:!1,type:"GET",dataType:"jsonp"});a=f.extend(a,{data:decodeURIComponent(b.param(m)),processData:!1,url:f.result(a,"url")},k);e=h.VERSION.split(".");var d=0===parseInt(e[0],10)&&9===parseInt(e[1],10)&&9>=parseInt(e[2],10),q=a.success;a.success=function(c,b,e){q&&(d?q(c,b,e):q(g,c,a));g&&g.trigger&&g.trigger("sync",g,c,a)};var p=a.error;a.error=function(c){p&&p(g,c,a);g&&g.trigger&&g.trigger("error",g,c,a)};e=a.xhr=b.ajax(a);g&&g.trigger&&g.trigger("request",g,e,a);return e},nextPage:function(b){this.currentPage<
this.information.totalPages&&(this.currentPage=++this.currentPage,this.pager(b))},previousPage:function(b){1<this.currentPage&&(this.currentPage=--this.currentPage,this.pager(b))},goTo:function(b,g){void 0!==b&&(this.currentPage=parseInt(b,10),this.pager(g))},howManyPer:function(b){if(void 0!==b){var g=this.perPage;this.perPage=parseInt(b,10);this.currentPage=Math.ceil((g*(this.currentPage-1)+1)/b);this.pager()}},setSort:function(b,g){void 0!==b&&void 0!==g&&(this.lastSortColumn=this.sortColumn,this.sortColumn=
b,this.sortDirection=g,this.pager(),this.info())},setFieldFilter:function(b){f.isEmpty(b)?(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=""):(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=b);this.pager();this.info()},doFakeFieldFilter:function(b){if(!f.isEmpty(b)){var g=this.origModels;void 0===g&&(g=this.models);g=this._fieldFilter(g,b);""!==this.filterExpression&&(g=this._filter(g,this.filterFields,this.filterExpression));return g.length}},setFilter:function(b,
g){void 0!==b&&void 0!==g&&(this.filterFields=b,this.lastFilterExpression=this.filterExpression,this.filterExpression=g,this.pager(),this.info())},doFakeFilter:function(b,g){if(void 0!==b&&void 0!==g){var k=this.origModels;void 0===k&&(k=this.models);f.isEmpty(this.fieldFilterRules)||(k=this._fieldFilter(k,this.fieldFilterRules));k=this._filter(k,b,g);return k.length}},pager:function(b){var g=this.perPage,k=(this.currentPage-1)*g,c=k+g;void 0===this.origModels&&(this.origModels=this.models);this.models=
this.origModels.slice();""!==this.sortColumn&&(this.models=this._sort(this.models,this.sortColumn,this.sortDirection));f.isEmpty(this.fieldFilterRules)||(this.models=this._fieldFilter(this.models,this.fieldFilterRules));""!==this.filterExpression&&(this.models=this._filter(this.models,this.filterFields,this.filterExpression));if(this.lastSortColumn!==this.sortColumn||this.lastFilterExpression!==this.filterExpression||!f.isEqual(this.fieldFilterRules,this.lastFieldFilterRules))k=0,c=k+g,this.currentPage=
1,this.lastSortColumn=this.sortColumn,this.lastFieldFilterRules=this.fieldFilterRules,this.lastFilterExpression=this.filterExpression;this.sortedAndFilteredModels=this.models.slice();this.info();this.reset(this.models.slice(k,c));f.result(b,"success")},_sort:function(b,g,k){return b=b.sort(function(c,b){var a=c.get(g),d=b.get(g);if(f.isUndefined(a)||f.isUndefined(d))return 0;a=a.toString().toLowerCase();d=d.toString().toLowerCase();if("desc"===k)if(!a.match(/[^\-\d\.]/)&&a.match(/-?[\d\.]*/)&&!d.match(/[^\-\d\.]/)&&
d.match(/-?[\d\.]*/)){if(a-0<d-0)return 1;if(a-0>d-0)return-1}else{if(a<d)return 1;if(a>d)return-1}else if(!a.match(/[^\-\d\.]/)&&a.match(/-?[\d\.]*/)&&!d.match(/[^\-\d\.]/)&&d.match(/-?[\d\.]*/)){if(a-0<d-0)return-1;if(a-0>d-0)return 1}else{if(a<d)return-1;if(a>d)return 1}return 0})},_fieldFilter:function(b,g){if(f.isEmpty(g))return b;var k=[];f.each(b,function(c){var b=!0;f.each(g,function(a){if(!b)return!1;b=!1;"function"===a.type?f.wrap(a.value,function(b){return b(c.get(a.field))})()&&(b=!0):
"required"===a.type?f.isEmpty(c.get(a.field).toString())||(b=!0):"min"===a.type?!f.isNaN(Number(c.get(a.field)))&&(!f.isNaN(Number(a.value))&&Number(c.get(a.field))>=Number(a.value))&&(b=!0):"max"===a.type?!f.isNaN(Number(c.get(a.field)))&&(!f.isNaN(Number(a.value))&&Number(c.get(a.field))<=Number(a.value))&&(b=!0):"range"===a.type?!f.isNaN(Number(c.get(a.field)))&&(f.isObject(a.value)&&!f.isNaN(Number(a.value.min))&&!f.isNaN(Number(a.value.max))&&Number(c.get(a.field))>=Number(a.value.min)&&Number(c.get(a.field))<=
Number(a.value.max))&&(b=!0):"minLength"===a.type?c.get(a.field).toString().length>=a.value&&(b=!0):"maxLength"===a.type?c.get(a.field).toString().length<=a.value&&(b=!0):"rangeLength"===a.type?f.isObject(a.value)&&(!f.isNaN(Number(a.value.min))&&!f.isNaN(Number(a.value.max))&&c.get(a.field).toString().length>=a.value.min&&c.get(a.field).toString().length<=a.value.max)&&(b=!0):"oneOf"===a.type?f.isArray(a.value)&&f.include(a.value,c.get(a.field))&&(b=!0):"equalTo"===a.type?a.value===c.get(a.field)&&
(b=!0):"containsAllOf"===a.type?f.isArray(a.value)&&(f.isArray(c.get(a.field))&&f.intersection(a.value,c.get(a.field)).length===a.value.length)&&(b=!0):"pattern"===a.type?c.get(a.field).toString().match(a.value)&&(b=!0):b=!1});b&&k.push(c)});return k},_filter:function(b,g,k){var c=this,m={};f.isString(g)?m[g]={cmp_method:"regexp"}:f.isArray(g)?f.each(g,function(a){m[a]={cmp_method:"regexp"}}):f.each(g,function(a,c){m[c]=f.defaults(a,{cmp_method:"regexp"})});g=m;f.has(h.Paginator,"removeDiacritics")&&
c.useDiacriticsPlugin&&(k=h.Paginator.removeDiacritics(k));if(""===k||!f.isString(k))return b;var a=f.map(k.match(/\w+/ig),function(a){return a.toLowerCase()}),d="("+f.uniq(a).join("|")+")",q=RegExp(d,"igm"),p=[];f.each(b,function(b){var d=[];f.each(g,function(e,g){var m=b.get(g);if(m){var p=[],m=f.has(h.Paginator,"removeDiacritics")&&c.useDiacriticsPlugin?h.Paginator.removeDiacritics(m.toString()):m.toString();"levenshtein"===e.cmp_method&&f.has(h.Paginator,"levenshtein")&&c.useLevenshteinPlugin?
(m=h.Paginator.levenshtein(m,k),f.defaults(e,{max_distance:0}),m<=e.max_distance&&(p=f.uniq(a))):p=m.match(q);p=f.map(p,function(a){return a.toString().toLowerCase()});f.each(p,function(a){d.push(a)})}});d=f.uniq(f.without(d,""));f.isEmpty(f.difference(a,d))&&p.push(b)});return p},info:function(){var b={},b=this.sortedAndFilteredModels?this.sortedAndFilteredModels.length:this.length,g=Math.ceil(b/this.perPage),b={totalUnfilteredRecords:this.origModels.length,totalRecords:b,currentPage:this.currentPage,
perPage:this.perPage,totalPages:g,lastPage:g,previous:!1,next:!1,startRecord:0===b?0:(this.currentPage-1)*this.perPage+1,endRecord:Math.min(b,this.currentPage*this.perPage)};1<this.currentPage&&(b.previous=this.currentPage-1);this.currentPage<b.totalPages&&(b.next=this.currentPage+1);b.pageSet=this.setPagination(b);return this.information=b},setPagination:function(b){var g=[],f=0,c=0,c=2*this.pagesInRange,m=Math.ceil(b.totalRecords/b.perPage);if(1<m)if(m<=1+c){f=1;for(c=m;f<=c;f++)g.push(f)}else if(b.currentPage<=
this.pagesInRange+1){f=1;for(c=2+c;f<c;f++)g.push(f)}else if(m-this.pagesInRange>b.currentPage&&b.currentPage>this.pagesInRange)for(f=b.currentPage-this.pagesInRange;f<=b.currentPage+this.pagesInRange;f++)g.push(f);else for(f=m-c;f<=m;f++)g.push(f);return g},bootstrap:function(b){f.extend(this,b);this.goTo(1);this.info();return this}});k.clientPager.prototype.prevPage=k.clientPager.prototype.previousPage;k.requestPager=h.Collection.extend({sync:function(e,g,k){var c=this;c.setDefaults();var m={};
f.each(f.result(c,"server_api"),function(a,b){f.isFunction(a)&&(a=f.bind(a,c),a=a());m[b]=a});var a=f.clone(c.paginator_core);f.each(a,function(b,d){f.isFunction(b)&&(b=f.bind(b,c),b=b());a[d]=b});a=f.defaults(a,{timeout:25E3,cache:!1,type:"GET",dataType:"jsonp"});k.data=k.data?decodeURIComponent(b.param(f.extend(m,k.data))):decodeURIComponent(b.param(m));a=f.extend(a,{data:decodeURIComponent(b.param(m)),processData:!1,url:f.result(a,"url")},k);e=h.VERSION.split(".");var d=0===parseInt(e[0],10)&&
9===parseInt(e[1],10)&&9>=parseInt(e[2],10),q=a.success;a.success=function(c,b,e){q&&(d?q(c,b,e):q(g,c,a));g&&g.trigger&&g.trigger("sync",g,c,a)};var p=a.error;a.error=function(c){p&&p(g,c,a);g&&g.trigger&&g.trigger("error",g,c,a)};e=a.xhr=b.ajax(a);g&&g.trigger&&g.trigger("request",g,e,a);return e},setDefaults:function(){var b=this;f.defaults(b.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4});f.each(b.paginator_ui,function(g,k){f.isUndefined(b[k])&&(b[k]=b.paginator_ui[k])})},
requestNextPage:function(e){if(void 0!==this.currentPage)return this.currentPage+=1,this.pager(e);e=new b.Deferred;e.reject();return e.promise()},requestPreviousPage:function(e){if(void 0!==this.currentPage)return this.currentPage-=1,this.pager(e);e=new b.Deferred;e.reject();return e.promise()},updateOrder:function(b){void 0!==b&&(this.sortField=b,this.pager())},goTo:function(e,g){if(void 0!==e)return this.currentPage=parseInt(e,10),this.pager(g);var f=new b.Deferred;f.reject();return f.promise()},
howManyPer:function(b){void 0!==b&&(this.currentPage=this.firstPage,this.perPage=b,this.pager())},info:function(){var b={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};1<this.currentPage&&(b.previous=this.currentPage-1);this.currentPage<b.totalPages&&(b.next=this.currentPage+1);b.hasNext=b.next;b.hasPrevious=b.next;b.pageSet=this.setPagination(b);
return this.information=b},setPagination:function(b){var g=[],f=0,c=0,c=2*this.pagesInRange,m=Math.ceil(b.totalRecords/b.perPage);if(1<m)if(m<=1+c){f=1;for(c=m;f<=c;f++)g.push(f)}else if(b.currentPage<=this.pagesInRange+1){f=1;for(c=2+c;f<c;f++)g.push(f)}else if(m-this.pagesInRange>b.currentPage&&b.currentPage>this.pagesInRange)for(f=b.currentPage-this.pagesInRange;f<=b.currentPage+this.pagesInRange;f++)g.push(f);else for(f=m-c;f<=m;f++)g.push(f);return g},pager:function(b){f.isObject(b)||(b={});
return this.fetch(b)},url:function(){return void 0!==this.paginator_core&&void 0!==this.paginator_core.url?this.paginator_core.url:null},bootstrap:function(b){f.extend(this,b);this.setDefaults();this.info();return this}});k.requestPager.prototype.nextPage=k.requestPager.prototype.requestNextPage;k.requestPager.prototype.prevPage=k.requestPager.prototype.requestPreviousPage;return k}(Backbone,_,jQuery);this.Handlebars={};
(function(h){h.VERSION="1.0.0-rc.3";h.COMPILER_REVISION=2;h.REVISION_CHANGES={1:"<= 1.0.rc.2",2:">= 1.0.0-rc.3"};h.helpers={};h.partials={};h.registerHelper=function(b,f,e){e&&(f.not=e);this.helpers[b]=f};h.registerPartial=function(b,f){this.partials[b]=f};h.registerHelper("helperMissing",function(b){if(2!==arguments.length)throw Error("Could not find property '"+b+"'");});var f=Object.prototype.toString;h.registerHelper("blockHelperMissing",function(b,k){var e=k.inverse||function(){},g=k.fn,l=f.call(b);
"[object Function]"===l&&(b=b.call(this));return!0===b?g(this):!1===b||null==b?e(this):"[object Array]"===l?0<b.length?h.helpers.each(b,k):e(this):g(b)});h.K=function(){};h.createFrame=Object.create||function(b){h.K.prototype=b;b=new h.K;h.K.prototype=null;return b};h.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{"0":"debug",1:"info",2:"warn",3:"error"},log:function(b,f){if(h.logger.level<=b){var e=h.logger.methodMap[b];"undefined"!==typeof console&&console[e]&&console[e].call(console,
f)}}};h.log=function(b,f){h.logger.log(b,f)};h.registerHelper("each",function(b,f){var e=f.fn,g=f.inverse,l=0,c="",m;f.data&&(m=h.createFrame(f.data));if(b&&"object"===typeof b)if(b instanceof Array)for(var a=b.length;l<a;l++)m&&(m.index=l),c+=e(b[l],{data:m});else for(a in b)b.hasOwnProperty(a)&&(m&&(m.key=a),c+=e(b[a],{data:m}),l++);0===l&&(c=g(this));return c});h.registerHelper("if",function(b,k){"[object Function]"===f.call(b)&&(b=b.call(this));return!b||h.Utils.isEmpty(b)?k.inverse(this):k.fn(this)});
h.registerHelper("unless",function(b,f){var e=f.fn;f.fn=f.inverse;f.inverse=e;return h.helpers["if"].call(this,b,f)});h.registerHelper("with",function(b,f){return f.fn(b)});h.registerHelper("log",function(b,f){var e=f.data&&null!=f.data.level?parseInt(f.data.level,10):1;h.log(e,b)})})(this.Handlebars);
var handlebars=function(){function h(){this.yy={}}var f={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,partialName:25,params:26,hash:27,DATA:28,param:29,STRING:30,INTEGER:31,BOOLEAN:32,hashSegments:33,hashSegment:34,ID:35,EQUALS:36,PARTIAL_NAME:37,
pathSegments:38,SEP:39,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"DATA",30:"STRING",31:"INTEGER",32:"BOOLEAN",35:"ID",36:"EQUALS",37:"PARTIAL_NAME",39:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[26,
2],[26,1],[29,1],[29,1],[29,1],[29,1],[29,1],[27,1],[33,2],[33,1],[34,3],[34,3],[34,3],[34,3],[34,3],[25,1],[21,1],[38,3],[38,1]],performAction:function(b,f,e,g,h,c){b=c.length-1;switch(h){case 1:return c[b-1];case 2:this.$=new g.ProgramNode([],c[b]);break;case 3:this.$=new g.ProgramNode(c[b-2],c[b]);break;case 4:this.$=new g.ProgramNode(c[b-1],[]);break;case 5:this.$=new g.ProgramNode(c[b]);break;case 6:this.$=new g.ProgramNode([],[]);break;case 7:this.$=new g.ProgramNode([]);break;case 8:this.$=
[c[b]];break;case 9:c[b-1].push(c[b]);this.$=c[b-1];break;case 10:this.$=new g.BlockNode(c[b-2],c[b-1].inverse,c[b-1],c[b]);break;case 11:this.$=new g.BlockNode(c[b-2],c[b-1],c[b-1].inverse,c[b]);break;case 12:this.$=c[b];break;case 13:this.$=c[b];break;case 14:this.$=new g.ContentNode(c[b]);break;case 15:this.$=new g.CommentNode(c[b]);break;case 16:this.$=new g.MustacheNode(c[b-1][0],c[b-1][1]);break;case 17:this.$=new g.MustacheNode(c[b-1][0],c[b-1][1]);break;case 18:this.$=c[b-1];break;case 19:this.$=
new g.MustacheNode(c[b-1][0],c[b-1][1]);break;case 20:this.$=new g.MustacheNode(c[b-1][0],c[b-1][1],!0);break;case 21:this.$=new g.PartialNode(c[b-1]);break;case 22:this.$=new g.PartialNode(c[b-2],c[b-1]);break;case 24:this.$=[[c[b-2]].concat(c[b-1]),c[b]];break;case 25:this.$=[[c[b-1]].concat(c[b]),null];break;case 26:this.$=[[c[b-1]],c[b]];break;case 27:this.$=[[c[b]],null];break;case 28:this.$=[[new g.DataNode(c[b])],null];break;case 29:c[b-1].push(c[b]);this.$=c[b-1];break;case 30:this.$=[c[b]];
break;case 31:this.$=c[b];break;case 32:this.$=new g.StringNode(c[b]);break;case 33:this.$=new g.IntegerNode(c[b]);break;case 34:this.$=new g.BooleanNode(c[b]);break;case 35:this.$=new g.DataNode(c[b]);break;case 36:this.$=new g.HashNode(c[b]);break;case 37:c[b-1].push(c[b]);this.$=c[b-1];break;case 38:this.$=[c[b]];break;case 39:this.$=[c[b-2],c[b]];break;case 40:this.$=[c[b-2],new g.StringNode(c[b])];break;case 41:this.$=[c[b-2],new g.IntegerNode(c[b])];break;case 42:this.$=[c[b-2],new g.BooleanNode(c[b])];
break;case 43:this.$=[c[b-2],new g.DataNode(c[b])];break;case 44:this.$=new g.PartialNameNode(c[b]);break;case 45:this.$=new g.IdNode(c[b]);break;case 46:c[b-2].push(c[b]);this.$=c[b-2];break;case 47:this.$=[c[b]]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],24:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],24:[1,16]},{5:[2,5],6:20,8:21,9:7,
11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],24:[1,16]},{17:23,18:[1,22],21:24,28:[1,25],35:[1,27],38:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{4:28,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],
19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{17:30,21:24,28:[1,25],35:[1,27],38:26},{17:31,21:24,28:[1,25],35:[1,27],38:26},{17:32,21:24,28:[1,25],35:[1,27],38:26},{25:33,37:[1,34]},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,
14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],24:[1,16]},{17:23,21:24,28:[1,25],35:[1,27],38:26},{5:[2,4],7:35,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],24:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],24:[2,23]},{18:[1,36]},{18:[2,27],21:41,26:37,27:38,28:[1,45],29:39,30:[1,42],31:[1,43],32:[1,44],33:40,
34:46,35:[1,47],38:26},{18:[2,28]},{18:[2,45],28:[2,45],30:[2,45],31:[2,45],32:[2,45],35:[2,45],39:[1,48]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],39:[2,47]},{10:49,20:[1,50]},{10:51,20:[1,50]},{18:[1,52]},{18:[1,53]},{18:[1,54]},{18:[1,55],21:56,35:[1,27],38:26},{18:[2,44],35:[2,44]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],24:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},
{18:[2,25],21:41,27:57,28:[1,45],29:58,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,26]},{18:[2,30],28:[2,30],30:[2,30],31:[2,30],32:[2,30],35:[2,30]},{18:[2,36],34:59,35:[1,60]},{18:[2,31],28:[2,31],30:[2,31],31:[2,31],32:[2,31],35:[2,31]},{18:[2,32],28:[2,32],30:[2,32],31:[2,32],32:[2,32],35:[2,32]},{18:[2,33],28:[2,33],30:[2,33],31:[2,33],32:[2,33],35:[2,33]},{18:[2,34],28:[2,34],30:[2,34],31:[2,34],32:[2,34],35:[2,34]},{18:[2,35],28:[2,35],30:[2,35],31:[2,35],32:[2,35],35:[2,
35]},{18:[2,38],35:[2,38]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],36:[1,61],39:[2,47]},{35:[1,62]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{21:63,35:[1,27],38:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,
20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],24:[2,21]},{18:[1,64]},{18:[2,24]},{18:[2,29],28:[2,29],30:[2,29],31:[2,29],32:[2,29],35:[2,29]},{18:[2,37],35:[2,37]},{36:[1,61]},{21:65,28:[1,69],30:[1,66],31:[1,67],32:[1,68],35:[1,27],38:26},{18:[2,46],28:[2,46],30:[2,46],31:[2,46],32:[2,46],35:[2,46],39:[2,46]},{18:[1,70]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],
22:[2,22],23:[2,22],24:[2,22]},{18:[2,39],35:[2,39]},{18:[2,40],35:[2,40]},{18:[2,41],35:[2,41]},{18:[2,42],35:[2,42]},{18:[2,43],35:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]}],defaultActions:{17:[2,1],25:[2,28],38:[2,26],57:[2,24]},parseError:function(b){throw Error(b);},parse:function(b){var f=[0],e=[null],g=[],h=this.table,c="",m=0,a=0,d=0;this.lexer.setInput(b);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;"undefined"==
typeof this.lexer.yylloc&&(this.lexer.yylloc={});b=this.lexer.yylloc;g.push(b);var q=this.lexer.options&&this.lexer.options.ranges;"function"===typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,v,u,t,w={},x,r;;){u=f[f.length-1];if(this.defaultActions[u])t=this.defaultActions[u];else{if(null===p||"undefined"==typeof p)p=void 0,p=this.lexer.lex()||1,"number"!==typeof p&&(p=this.symbols_[p]||p);t=h[u]&&h[u][p]}if("undefined"===typeof t||!t.length||!t[0]){var z="";if(!d){r=[];
for(x in h[u])this.terminals_[x]&&2<x&&r.push("'"+this.terminals_[x]+"'");z=this.lexer.showPosition?"Parse error on line "+(m+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+r.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(m+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'");this.parseError(z,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:b,expected:r})}}if(t[0]instanceof Array&&1<t.length)throw Error("Parse Error: multiple actions possible at state: "+
u+", token: "+p);switch(t[0]){case 1:f.push(p);e.push(this.lexer.yytext);g.push(this.lexer.yylloc);f.push(t[1]);p=null;v?(p=v,v=null):(a=this.lexer.yyleng,c=this.lexer.yytext,m=this.lexer.yylineno,b=this.lexer.yylloc,0<d&&d--);break;case 2:r=this.productions_[t[1]][1];w.$=e[e.length-r];w._$={first_line:g[g.length-(r||1)].first_line,last_line:g[g.length-1].last_line,first_column:g[g.length-(r||1)].first_column,last_column:g[g.length-1].last_column};q&&(w._$.range=[g[g.length-(r||1)].range[0],g[g.length-
1].range[1]]);u=this.performAction.call(w,c,a,m,this.yy,t[1],e,g);if("undefined"!==typeof u)return u;r&&(f=f.slice(0,-2*r),e=e.slice(0,-1*r),g=g.slice(0,-1*r));f.push(this.productions_[t[1]][0]);e.push(w.$);g.push(w._$);t=h[f[f.length-2]][f[f.length-1]];f.push(t);break;case 3:return!0}}return!0},lexer:{EOF:1,parseError:function(b,f){if(this.yy.parser)this.yy.parser.parseError(b,f);else throw Error(b);},setInput:function(b){this._input=b;this._more=this._less=this.done=!1;this.yylineno=this.yyleng=
0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var b=this._input[0];this.yytext+=b;this.yyleng++;this.offset++;this.match+=b;this.matched+=b;b.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return b},
unput:function(b){var f=b.length,e=b.split(/(?:\r\n?|\n)/g);this._input=b+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-f-1);this.offset-=f;b=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);e.length-1&&(this.yylineno-=e.length-1);var g=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:e?(e.length===
b.length?this.yylloc.first_column:0)+b[b.length-e.length].length-e[0].length:this.yylloc.first_column-f};this.options.ranges&&(this.yylloc.range=[g[0],g[0]+this.yyleng-f]);return this},more:function(){this._more=!0;return this},less:function(b){this.unput(this.match.slice(b))},pastInput:function(){var b=this.matched.substr(0,this.matched.length-this.match.length);return(20<b.length?"...":"")+b.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var b=this.match;20>b.length&&(b+=this._input.substr(0,
20-b.length));return(b.substr(0,20)+(20<b.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var b=this.pastInput(),f=Array(b.length+1).join("-");return b+this.upcomingInput()+"\n"+f+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var b,f,e;this._more||(this.match=this.yytext="");for(var g=this._currentRules(),h=0;h<g.length;h++)if((f=this._input.match(this.rules[g[h]]))&&(!b||f[0].length>b[0].length))if(b=f,e=h,!this.options.flex)break;if(b){if(f=b[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=
f.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:f?f[f.length-1].length-f[f.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length};this.yytext+=b[0];this.match+=b[0];this.matches=b;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._more=!1;this._input=this._input.slice(b[0].length);this.matched+=b[0];b=this.performAction.call(this,this.yy,
this,g[e],this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(b)return b}else return""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return"undefined"!==typeof b?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-
1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(b){this.begin(b)},options:{},performAction:function(b,f,e){switch(e){case 0:"\\"!==f.yytext.slice(-1)&&this.begin("mu");"\\"===f.yytext.slice(-1)&&(f.yytext=f.yytext.substr(0,f.yyleng-1),this.begin("emu"));if(f.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==f.yytext.slice(-1)&&this.popState(),"\\"===f.yytext.slice(-1)&&(f.yytext=f.yytext.substr(0,f.yyleng-1)),14;case 3:return f.yytext=
f.yytext.substr(0,f.yyleng-4),this.popState(),15;case 4:return this.begin("par"),24;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 23;case 11:this.popState();this.begin("com");break;case 12:return f.yytext=f.yytext.substr(3,f.yyleng-5),this.popState(),15;case 13:return 22;case 14:return 36;case 15:return 35;case 16:return 35;case 17:return 39;case 19:return this.popState(),18;case 20:return this.popState(),18;case 21:return f.yytext=f.yytext.substr(1,
f.yyleng-2).replace(/\\"/g,'"'),30;case 22:return f.yytext=f.yytext.substr(1,f.yyleng-2).replace(/\\'/g,"'"),30;case 23:return f.yytext=f.yytext.substr(1),28;case 24:return 32;case 25:return 32;case 26:return 31;case 27:return 35;case 28:return f.yytext=f.yytext.substr(1,f.yyleng-2),35;case 29:return"INVALID";case 31:return this.popState(),37;case 32:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,
/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:\s+)/,/^(?:[a-zA-Z0-9_$-/]+)/,/^(?:$)/],conditions:{mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
19,20,21,22,23,24,25,26,27,28,29,32],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},par:{rules:[30,31],inclusive:!1},INITIAL:{rules:[0,1,32],inclusive:!0}}}};h.prototype=f;f.Parser=h;return new h}();Handlebars.Parser=handlebars;Handlebars.parse=function(h){if(h.constructor===Handlebars.AST.ProgramNode)return h;Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(h)};Handlebars.print=function(h){return(new Handlebars.PrintVisitor).accept(h)};
(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(h,f){this.type="program";this.statements=h;f&&(this.inverse=new Handlebars.AST.ProgramNode(f))};Handlebars.AST.MustacheNode=function(h,f,b){this.type="mustache";this.escaped=!b;this.hash=f;b=this.id=h[0];h=this.params=h.slice(1);this.isHelper=(this.eligibleHelper=b.isSimple)&&(h.length||f)};Handlebars.AST.PartialNode=function(h,f){this.type="partial";this.partialName=h;this.context=f};Handlebars.AST.BlockNode=function(h,f,b,k){var e=
h.id;if(e.original!==k.original)throw new Handlebars.Exception(e.original+" doesn't match "+k.original);this.type="block";this.mustache=h;this.program=f;if((this.inverse=b)&&!this.program)this.isInverse=!0};Handlebars.AST.ContentNode=function(h){this.type="content";this.string=h};Handlebars.AST.HashNode=function(h){this.type="hash";this.pairs=h};Handlebars.AST.IdNode=function(h){this.type="ID";this.original=h.join(".");for(var f=[],b=0,k=0,e=h.length;k<e;k++){var g=h[k];if(".."===g||"."===g||"this"===
g){if(0<f.length)throw new Handlebars.Exception("Invalid path: "+this.original);".."===g?b++:this.isScoped=!0}else f.push(g)}this.parts=f;this.string=f.join(".");this.depth=b;this.isSimple=1===h.length&&!this.isScoped&&0===b;this.stringModeValue=this.string};Handlebars.AST.PartialNameNode=function(h){this.type="PARTIAL_NAME";this.name=h};Handlebars.AST.DataNode=function(h){this.type="DATA";this.id=h};Handlebars.AST.StringNode=function(h){this.type="STRING";this.stringModeValue=this.string=h};Handlebars.AST.IntegerNode=
function(h){this.type="INTEGER";this.integer=h;this.stringModeValue=Number(h)};Handlebars.AST.BooleanNode=function(h){this.type="BOOLEAN";this.bool=h;this.stringModeValue="true"===h};Handlebars.AST.CommentNode=function(h){this.type="comment";this.comment=h}})();var errorProps="description fileName lineNumber message name number stack".split(" ");Handlebars.Exception=function(h){for(var f=Error.prototype.constructor.apply(this,arguments),b=0;b<errorProps.length;b++)this[errorProps[b]]=f[errorProps[b]]};
Handlebars.Exception.prototype=Error();Handlebars.SafeString=function(h){this.string=h};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};
(function(){var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},f=/[&<>"'`]/g,b=/[&<>"'`]/,k=function(b){return h[b]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){return e instanceof Handlebars.SafeString?e.toString():null==e||!1===e?"":!b.test(e)?e:e.replace(f,k)},isEmpty:function(b){return!b&&0!==b?!0:"[object Array]"===Object.prototype.toString.call(b)&&0===b.length?!0:!1}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};
(function(h,f){h.prototype={compiler:h,disassemble:function(){for(var c=this.opcodes,b,a=[],d,e,f=0,g=c.length;f<g;f++)if(b=c[f],"DECLARE"===b.opcode)a.push("DECLARE "+b.name+"="+b.value);else{d=[];for(var h=0;h<b.args.length;h++)e=b.args[h],"string"===typeof e&&(e='"'+e.replace("\n","\\n")+'"'),d.push(e);a.push(b.opcode+" "+d.join(" "))}return a.join("\n")},equals:function(c){var b=this.opcodes.length;if(c.opcodes.length!==b)return!1;for(var a=0;a<b;a++){var d=this.opcodes[a],e=c.opcodes[a];if(d.opcode!==
e.opcode||d.args.length!==e.args.length)return!1;for(var f=0;f<d.args.length;f++)if(d.args[f]!==e.args[f])return!1}return!0},guid:0,compile:function(c,b){this.children=[];this.depths={list:[]};this.options=b;var a=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(a)for(var d in a)this.options.knownHelpers[d]=a[d];return this.program(c)},accept:function(c){return this[c.type](c)},program:function(c){c=c.statements;
var b;this.opcodes=[];for(var a=0,d=c.length;a<d;a++)b=c[a],this[b.type](b);this.isSimple=1===d;this.depths.list=this.depths.list.sort(function(a,c){return a-c});return this},compileProgram:function(c){c=(new this.compiler).compile(c,this.options);var b=this.guid++,a;this.usePartial=this.usePartial||c.usePartial;this.children[b]=c;for(var d=0,e=c.depths.list.length;d<e;d++)a=c.depths.list[d],2>a||this.addDepth(a-1);return b},block:function(c){var b=c.mustache,a=c.program;c=c.inverse;a&&(a=this.compileProgram(a));
c&&(c=this.compileProgram(c));var d=this.classifyMustache(b);"helper"===d?this.helperMustache(b,a,c):"simple"===d?(this.simpleMustache(b),this.opcode("pushProgram",a),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(b,a,c),this.opcode("pushProgram",a),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue"));this.opcode("append")},hash:function(c){c=c.pairs;var b,a;this.opcode("pushHash");for(var d=0,e=c.length;d<
e;d++)b=c[d],a=b[1],this.options.stringParams?this.opcode("pushStringParam",a.stringModeValue,a.type):this.accept(a),this.opcode("assignToHash",b[0]);this.opcode("popHash")},partial:function(c){var b=c.partialName;this.usePartial=!0;c.context?this.ID(c.context):this.opcode("push","depth0");this.opcode("invokePartial",b.name);this.opcode("append")},content:function(c){this.opcode("appendContent",c.string)},mustache:function(c){var b=this.options,a=this.classifyMustache(c);"simple"===a?this.simpleMustache(c):
"helper"===a?this.helperMustache(c):this.ambiguousMustache(c);c.escaped&&!b.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(c,b,a){c=c.id;var d=c.parts[0],e=null!=b||null!=a;this.opcode("getContext",c.depth);this.opcode("pushProgram",b);this.opcode("pushProgram",a);this.opcode("invokeAmbiguous",d,e)},simpleMustache:function(c){c=c.id;"DATA"===c.type?this.DATA(c):c.parts.length?this.ID(c):(this.addDepth(c.depth),this.opcode("getContext",c.depth),this.opcode("pushContext"));
this.opcode("resolvePossibleLambda")},helperMustache:function(c,b,a){b=this.setupFullMustacheParams(c,b,a);c=c.id.parts[0];if(this.options.knownHelpers[c])this.opcode("invokeKnownHelper",b.length,c);else{if(this.knownHelpersOnly)throw Error("You specified knownHelpersOnly, but used the unknown helper "+c);this.opcode("invokeHelper",b.length,c)}},ID:function(c){this.addDepth(c.depth);this.opcode("getContext",c.depth);c.parts[0]?this.opcode("lookupOnContext",c.parts[0]):this.opcode("pushContext");for(var b=
1,a=c.parts.length;b<a;b++)this.opcode("lookup",c.parts[b])},DATA:function(c){this.options.data=!0;this.opcode("lookupData",c.id)},STRING:function(c){this.opcode("pushString",c.string)},INTEGER:function(c){this.opcode("pushLiteral",c.integer)},BOOLEAN:function(c){this.opcode("pushLiteral",c.bool)},comment:function(){},opcode:function(c){this.opcodes.push({opcode:c,args:[].slice.call(arguments,1)})},declare:function(c,b){this.opcodes.push({opcode:"DECLARE",name:c,value:b})},addDepth:function(c){if(isNaN(c))throw Error("EWOT");
0!==c&&!this.depths[c]&&(this.depths[c]=!0,this.depths.list.push(c))},classifyMustache:function(c){var b=c.isHelper,a=c.eligibleHelper,d=this.options;a&&!b&&(d.knownHelpers[c.id.parts[0]]?b=!0:d.knownHelpersOnly&&(a=!1));return b?"helper":a?"ambiguous":"simple"},pushParams:function(c){for(var b=c.length,a;b--;)if(a=c[b],this.options.stringParams)a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",a.stringModeValue,a.type);else this[a.type](a)},setupMustacheParams:function(c){var b=
c.params;this.pushParams(b);c.hash?this.hash(c.hash):this.opcode("emptyHash");return b},setupFullMustacheParams:function(c,b,a){var d=c.params;this.pushParams(d);this.opcode("pushProgram",b);this.opcode("pushProgram",a);c.hash?this.hash(c.hash):this.opcode("emptyHash");return d}};var b=function(c){this.value=c};f.prototype={nameLookup:function(c,b){return/^[0-9]+$/.test(b)?c+"["+b+"]":f.isValidJavaScriptVariableName(b)?c+"."+b:c+"['"+b+"']"},appendToBuffer:function(c){return this.environment.isSimple?
"return "+c+";":{appendToBuffer:!0,content:c,toString:function(){return"buffer += "+c+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(c,b,a,d){this.environment=c;this.options=b||{};Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n");this.name=this.environment.name;this.isChild=!!a;this.context=a||{programs:[],environments:[],aliases:{}};this.preamble();this.stackSlot=0;this.stackVars=[];this.registers={list:[]};this.compileStack=
[];this.inlineStack=[];this.compileChildren(c,b);c=c.opcodes;this.i=0;for(l=c.length;this.i<l;this.i++)b=c[this.i],"DECLARE"===b.opcode?this[b.name]=b.value:this[b.opcode].apply(this,b.args);return this.createFunctionContext(d)},nextOpcode:function(){return this.environment.opcodes[this.i+1]},eat:function(){this.i+=1},preamble:function(){var c=[];if(this.isChild)c.push("");else{var b=this.namespace,a="helpers = helpers || "+b+".helpers;";this.environment.usePartial&&(a=a+" partials = partials || "+
b+".partials;");this.options.data&&(a+=" data = data || {};");c.push(a)}this.environment.isSimple?c.push(""):c.push(", buffer = "+this.initializeBuffer());this.lastContext=0;this.source=c},createFunctionContext:function(c){var b=this.stackVars.concat(this.registers.list);0<b.length&&(this.source[1]=this.source[1]+", "+b.join(", "));if(!this.isChild)for(var a in this.context.aliases)this.source[1]=this.source[1]+", "+a+"="+this.context.aliases[a];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+
";");this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n");this.environment.isSimple||this.source.push("return buffer;");b=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];a=0;for(var d=this.environment.depths.list.length;a<d;a++)b.push("depth"+this.environment.depths.list[a]);a=this.mergeSource();this.isChild||(d=Handlebars.COMPILER_REVISION,a="this.compilerInfo = ["+d+",'"+Handlebars.REVISION_CHANGES[d]+"'];\n"+a);if(c)return b.push(a),Function.apply(this,
b);c="function "+(this.name||"")+"("+b.join(",")+") {\n  "+a+"}";Handlebars.log(Handlebars.logger.DEBUG,c+"\n\n");return c},mergeSource:function(){for(var c="",b,a=0,d=this.source.length;a<d;a++){var e=this.source[a];e.appendToBuffer?b=b?b+"\n    + "+e.content:e.content:(b&&(c+="buffer += "+b+";\n  ",b=void 0),c+=e+"\n  ")}return c},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var c=["depth0"];this.setupParams(0,c);this.replaceStack(function(b){c.splice(1,
0,b);return"blockHelperMissing.call("+c.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var c=["depth0"];this.setupParams(0,c);var b=this.topStack();c.splice(1,0,b);c[c.length-1]="options";this.source.push("if (!"+this.lastHelper+") { "+b+" = blockHelperMissing.call("+c.join(", ")+"); }")},appendContent:function(c){this.source.push(this.appendToBuffer(this.quotedString(c)))},append:function(){this.flushInline();var c=this.popStack();
this.source.push("if("+c+" || "+c+" === 0) { "+this.appendToBuffer(c)+" }");this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression";this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(c){this.lastContext!==c&&(this.lastContext=c)},lookupOnContext:function(c){this.push(this.nameLookup("depth"+this.lastContext,c,"context"))},pushContext:function(){this.pushStackLiteral("depth"+
this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"';this.replaceStack(function(c){return"typeof "+c+" === functionType ? "+c+".apply(depth0) : "+c})},lookup:function(c){this.replaceStack(function(b){return b+" == null || "+b+" === false ? "+b+" : "+this.nameLookup(b,c,"context")})},lookupData:function(b){this.push(this.nameLookup("data",b,"data"))},pushStringParam:function(b,e){this.pushStackLiteral("depth"+this.lastContext);this.pushString(e);"string"===
typeof b?this.pushString(b):this.pushStackLiteral(b)},emptyHash:function(){this.pushStackLiteral("{}");this.options.stringParams&&this.register("hashTypes","{}")},pushHash:function(){this.hash={values:[],types:[]}},popHash:function(){var b=this.hash;this.hash=void 0;this.options.stringParams&&this.register("hashTypes","{"+b.types.join(",")+"}");this.push("{\n    "+b.values.join(",\n    ")+"\n  }")},pushString:function(b){this.pushStackLiteral(this.quotedString(b))},push:function(b){this.inlineStack.push(b);
return b},pushLiteral:function(b){this.pushStackLiteral(b)},pushProgram:function(b){null!=b?this.pushStackLiteral(this.programExpression(b)):this.pushStackLiteral(null)},invokeHelper:function(b,e){this.context.aliases.helperMissing="helpers.helperMissing";var a=this.lastHelper=this.setupHelper(b,e,!0);this.push(a.name);this.replaceStack(function(b){return b+" ? "+b+".call("+a.callParams+") : helperMissing.call("+a.helperMissingParams+")"})},invokeKnownHelper:function(b,e){var a=this.setupHelper(b,
e);this.push(a.name+".call("+a.callParams+")")},invokeAmbiguous:function(b,e){this.context.aliases.functionType='"function"';this.pushStackLiteral("{}");var a=this.setupHelper(0,b,e),d=this.lastHelper=this.nameLookup("helpers",b,"helper"),f=this.nameLookup("depth"+this.lastContext,b,"context"),g=this.nextStack();this.source.push("if ("+g+" = "+d+") { "+g+" = "+g+".call("+a.callParams+"); }");this.source.push("else { "+g+" = "+f+"; "+g+" = typeof "+g+" === functionType ? "+g+".apply(depth0) : "+g+
"; }")},invokePartial:function(b){b=[this.nameLookup("partials",b,"partial"),"'"+b+"'",this.popStack(),"helpers","partials"];this.options.data&&b.push("data");this.context.aliases.self="this";this.push("self.invokePartial("+b.join(", ")+")")},assignToHash:function(b){var e=this.popStack(),a;this.options.stringParams&&(a=this.popStack(),this.popStack());var d=this.hash;a&&d.types.push("'"+b+"': "+a);d.values.push("'"+b+"': ("+e+")")},compiler:f,compileChildren:function(b,e){for(var a=b.children,d,
f,g=0,h=a.length;g<h;g++){d=a[g];f=new this.compiler;var k=this.matchExistingProgram(d);null==k?(this.context.programs.push(""),k=this.context.programs.length,d.index=k,d.name="program"+k,this.context.programs[k]=f.compile(d,e,this.context),this.context.environments[k]=d):(d.index=k,d.name="program"+k)}},matchExistingProgram:function(b){for(var e=0,a=this.context.environments.length;e<a;e++){var d=this.context.environments[e];if(d&&d.equals(b))return e}},programExpression:function(b){this.context.aliases.self=
"this";if(null==b)return"self.noop";var e=this.environment.children[b];b=e.depths.list;for(var a=[e.index,e.name,"data"],d=0,f=b.length;d<f;d++)e=b[d],1===e?a.push("depth0"):a.push("depth"+(e-1));if(0===b.length)return"self.program("+a.join(", ")+")";a.shift();return"self.programWithDepth("+a.join(", ")+")"},register:function(b,e){this.useRegister(b);this.source.push(b+" = "+e+";")},useRegister:function(b){this.registers[b]||(this.registers[b]=!0,this.registers.list.push(b))},pushStackLiteral:function(c){return this.push(new b(c))},
pushStack:function(b){this.flushInline();var e=this.incrStack();b&&this.source.push(e+" = "+b+";");this.compileStack.push(e);return e},replaceStack:function(c){var e="",a=this.isInline(),d;a?(d=this.popStack(!0),d instanceof b?d=d.value:(e=this.stackSlot?this.topStackName():this.incrStack(),e="("+this.push(e)+" = "+d+"),",d=this.topStack())):d=this.topStack();c=c.call(this,d);a?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+e+c+")")):(/^stack/.test(d)||(d=this.nextStack()),
this.source.push(d+" = ("+e+c+");"));return d},nextStack:function(){return this.pushStack()},incrStack:function(){this.stackSlot++;this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot);return this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var c=this.inlineStack;if(c.length){this.inlineStack=[];for(var e=0,a=c.length;e<a;e++){var d=c[e];d instanceof b?this.compileStack.push(d):this.pushStack(d)}}},isInline:function(){return this.inlineStack.length},
popStack:function(c){var e=this.isInline(),a=(e?this.inlineStack:this.compileStack).pop();if(!c&&a instanceof b)return a.value;e||this.stackSlot--;return a},topStack:function(c){var e=this.isInline()?this.inlineStack:this.compileStack,e=e[e.length-1];return!c&&e instanceof b?e.value:e},quotedString:function(b){return'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(b,e,a){var d=[];this.setupParams(b,d,a);b=this.nameLookup("helpers",
e,"helper");return{params:d,name:b,callParams:["depth0"].concat(d).join(", "),helperMissingParams:a&&["depth0",this.quotedString(e)].concat(d).join(", ")}},setupParams:function(b,e,a){var d=[],f=[],g=[],h,k;d.push("hash:"+this.popStack());h=this.popStack();if((k=this.popStack())||h)k||(this.context.aliases.self="this",k="self.noop"),h||(this.context.aliases.self="this",h="self.noop"),d.push("inverse:"+h),d.push("fn:"+k);for(k=0;k<b;k++)h=this.popStack(),e.push(h),this.options.stringParams&&(g.push(this.popStack()),
f.push(this.popStack()));this.options.stringParams&&(d.push("contexts:["+f.join(",")+"]"),d.push("types:["+g.join(",")+"]"),d.push("hashTypes:hashTypes"));this.options.data&&d.push("data:data");d="{"+d.join(",")+"}";a?(this.register("options",d),e.push("options")):e.push(d);return e.join(", ")}};for(var k="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),
e=f.RESERVED_WORDS={},g=0,l=k.length;g<l;g++)e[k[g]]=!0;f.isValidJavaScriptVariableName=function(b){return!f.RESERVED_WORDS[b]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(b)?!0:!1}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);
Handlebars.precompile=function(h,f){if(!h||"string"!==typeof h&&h.constructor!==Handlebars.AST.ProgramNode)throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+h);f=f||{};"data"in f||(f.data=!0);var b=Handlebars.parse(h),b=(new Handlebars.Compiler).compile(b,f);return(new Handlebars.JavaScriptCompiler).compile(b,f)};
Handlebars.compile=function(h,f){if(!h||"string"!==typeof h&&h.constructor!==Handlebars.AST.ProgramNode)throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+h);f=f||{};"data"in f||(f.data=!0);var b;return function(k,e){if(!b){var g=Handlebars.parse(h),g=(new Handlebars.Compiler).compile(g,f),g=(new Handlebars.JavaScriptCompiler).compile(g,f,void 0,!0);b=Handlebars.template(g)}return b.call(this,k,e)}};
Handlebars.VM={template:function(h){var f={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(b,f,e){var g=this.programs[b];if(e)return Handlebars.VM.program(f,e);g||(g=this.programs[b]=Handlebars.VM.program(f));return g},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(b,k){k=k||{};var e=h.call(f,Handlebars,b,k.helpers,k.partials,k.data),g=f.compilerInfo||[],l=g[0]||1,
c=Handlebars.COMPILER_REVISION;if(l!==c){if(l<c)throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+Handlebars.REVISION_CHANGES[c]+") or downgrade your runtime to an older version ("+Handlebars.REVISION_CHANGES[l]+").";throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+").";}return e}},programWithDepth:function(h,
f,b){var k=Array.prototype.slice.call(arguments,2);return function(b,g){g=g||{};return h.apply(this,[b,g.data||f].concat(k))}},program:function(h,f){return function(b,k){k=k||{};return h(b,k.data||f)}},noop:function(){return""},invokePartial:function(h,f,b,k,e,g){k={helpers:k,partials:e,data:g};if(void 0===h)throw new Handlebars.Exception("The partial "+f+" could not be found");if(h instanceof Function)return h(b,k);if(Handlebars.compile)return e[f]=Handlebars.compile(h,{data:void 0!==g}),e[f](b,
k);throw new Handlebars.Exception("The partial "+f+" could not be compiled when running in runtime-only mode");}};Handlebars.template=Handlebars.VM.template;(function(){var h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},f={}.hasOwnProperty,b=function(a,b){function c(){this.constructor=a}for(var e in b)f.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};this.__addMethod=function(a,b){if("function"!==typeof b)throw new TypeError("Expected a function, got something else");if(null==this.prototype[a])return this.prototype[a]=b};_([Object,Number,String,
Date]).each(function(a){return a.define=__addMethod});Date.seconds=function(a){return 1E3*a};Date.minutes=function(a){return 60*Date.seconds(a)};Date.hours=function(a){return 60*Date.minutes(a)};Date.days=function(a){return 24*Date.hours(a)};Date.prototype.addTime=function(a){return this.setTime(this.valueOf()+a)};Date.prototype.addSeconds=function(a){return this.addTime(Date.seconds(a))};Date.prototype.addMinutes=function(a){return this.addTime(Date.minutes(a))};Date.prototype.addHours=function(a){return this.addTime(Date.hours(a))};
Date.prototype.addDays=function(a){return this.addTime(Date.days(a))};Number.prototype.errVal=void 0;Number.define("toInt",function(){return parseInt(this)});Number.define("toF",function(){return parseFloat(this)});Number.define("plus",function(a){var b;return(b=this.toF()+a.toF())?b:this.errVal});Number.define("minus",function(a){var b;return(b=this.toF()-a.toF())?b:this.errVal});Number.define("by",function(a){var b;return(b=this.toF()*a.toF())?b:this.errVal});Number.define("divideBy",function(a){var b;
return(b=this.toF()/a.toF())?b:this.errVal});String.define("trim",function(){return this.replace(/^\s+|\s+$/g,"")});String.define("ltrim",function(){return this.replace(/^\s+/g,"")});String.define("rtrim",function(){return this.replace(/\s+$/g,"")});String.define("unslash",function(){return this.replace(/^\/+|\/+$/g,"")});String.define("capitalize",function(){return this.charAt(0).toUpperCase()+this.slice(1)});String.define("camelize",function(){return _.map(this.split(/\s|_|-/),function(a){return a.capitalize()}).join("")});
String.define("underscored",function(){return this.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()});String.define("army",function(a){var b;for(b=[];b.length<a;)b.push(this);return b.join("")});String.define("leftFill",function(a,b){return(a.army(b)+this).slice(-1*b)});this.Sharkbone={Version:"0.1.0",Config:{},Modules:{},ClassModules:{},App:{Models:{},Collections:{},Views:{},Routers:{},Modules:{},Initializers:{initializeRouters:function(a){null==a&&(a=this.options);return this.activeRouters=
_(this.Routers).map(function(b){return new b(a)})},setupBackboneRelational:function(){if(null!=Backbone.RelationalModel)return _(this.Models).invoke("setup")}},activeRouters:[],options:{pushState:!1},initialize:function(){var a=this;_(this.Initializers).each(function(b){return b.call(a,a.options)});return Backbone.history.start()}}};var k=Sharkbone,e=function(){};e.mixinCallbacks=["beforeInclude","beforeExtend","included","extended"];e.extend=function(a){var b,c,e,f=this;b="object"===typeof a?a:a.prototype;
null!=(c=b.beforeExtend)&&c.apply(this,b);_.each(Object.keys(b),function(a){if(0>h.call(f.mixinCallbacks,a))return f[a]=b[a]});null!=(e=b.extended)&&e.apply(this,b);return this};e.include=function(a){var b,c,e,f=this;b="object"===typeof a?a:a.prototype;null!=(c=b.beforeInclude)&&c.apply(this,b);_.each(Object.keys(b),function(a){if(0>h.call(f.mixinCallbacks,a))return f.prototype[a]=b[a]});null!=(e=b.included)&&e.apply(this,b);return this};k.Mixin=e;k=Sharkbone;e=function(){};e.prototype.appNamespace=
function(){return"Sharkbone.App."};k.Shared=e;Sharkbone.Modules.NavigationHelpers={goToIndex:function(){return Backbone.history.location.assign(this.indexPath())},goToShow:function(){return Backbone.history.location.assign(this.showPath())}};Sharkbone.Modules.RouteHelpers={getRootPath:function(a){var b,c;return(null!=a?a.urlRoot:void 0)||(null!=(b=this.model)?b.urlRoot:void 0)||(null!=(c=this.collection)?c.url:void 0)},getResourceId:function(a){var b;return(null!=a?a.id:void 0)||(null!=(b=this.model)?
b.id:void 0)},indexPath:function(a){return"#"+this.getRootPath(a)},showPath:function(a,b,c,e){a=this.getRootPath(e);e=this.getResourceId(e);return"#"+a+"/"+e},editPath:function(a,b,c,e){return""+this.showPath.apply(this,arguments)+"/edit"}};k=Sharkbone;e=function(){};_.extend(e,Sharkbone.Mixin);e.prototype.getDesktop=function(){return this.desktop||(this.desktop=new Sharkbone.Desktop)};e.prototype.clearWorkSpace=function(a){return this.getDesktop().clear(a)};e.prototype.renderOn=function(a,b,c){return $(a).html((new b(c)).render().el)};
e.include(Sharkbone.Modules.NavigationHelpers);e.include(Sharkbone.Modules.RouteHelpers);k.ViewManager=e;k=Sharkbone;e=function(){};_.extend(e,Sharkbone.Mixin);e.prototype.layouts={"default":{},login:{}};e.prototype.activeLayoutName="default";e.prototype.layout=function(){return this.layouts[this.activeLayoutName]};e.prototype.getLayout=function(){return this.layouts[this.activeLayoutName]};e.prototype.clear=function(a){var b;b=null!=a?this.getLayout()[a]:this.getLayout();"function"===typeof b&&(b=
b());null!=b.html?b.html(""):_.each(_.values(b),function(a){"function"===typeof a&&(a=a());if(null!=a.html)return a.html("")});return this.afterClear(b,a)};e.prototype.afterClear=function(a,b){var c=this;return _.each(this._afterClear,function(e){return null!=e?e.call(c,a,b):void 0})};k.Desktop=e;var k=Sharkbone,g=function(){g.__super__.constructor.apply(this,arguments)};b(g,Backbone.Router);_.extend(g,Sharkbone.Mixin);g.include(Sharkbone.ViewManager);g.defaultCollectionName=function(){return this.name.replace(/router|controller/gi,
"")};g.collectionClass=function(){return("function"===typeof this.defaultCollectionName?this.defaultCollectionName():void 0)||this.defaultCollectionName};g.collectionName=function(){return(("function"===typeof this.collectionClass?this.collectionClass():void 0)||this.collectionClass).underscored()};g.resources=function(a){var b;a||(a=("function"===typeof this.collectionName?this.collectionName():void 0)||this.collectionName);(b=this.prototype).routes||(b.routes={});this.prototype.routes[""+a+"/index"]=
"index";this.prototype.routes[""+a]="index";this.prototype.routes[""+a+"/new"]="newModel";this.prototype.routes[""+a+"/:id/edit"]="edit";return this.prototype.routes[""+a+"/:id"]="show"};g.prototype.initialize=function(){var a,b;g.__super__.initialize.apply(this,arguments);return this.collection="function"===typeof(a=Sharkbone.App.Collections)[b=this.constructor.collectionClass()]?new a[b]:void 0};g.prototype.loadDefaultData=function(){return this.collection.fetch()};g.prototype.getResource=function(a){this.model=
this.collection.get(a)||new this.collection.model({id:a});this.model.fetch();return this.model};k.Router=g;var k=Sharkbone,l=function(){l.__super__.constructor.apply(this,arguments)};b(l,Backbone.Paginator.requestPager||Backbone.Collection);_.extend(l,Sharkbone.Mixin);l.prototype.initialize=function(){return l.__super__.initialize.apply(this,arguments)};null!=Backbone.Paginator.requestPager&&(l.prototype.DefaultPagesInRange=4,l.prototype.paginator_core={dataType:"json",url:function(){return this.url}},
l.prototype.paginator_ui={firstPage:1,currentPage:1,perPage:20,totalPages:10,pageLinks:{wrapperTag:"ul",defaultClass:"",disabledClass:"disabled",numberedPageOptions:{"class":"page-marker",selectedClass:"disabled",unselectedClass:""},first:{label:"<<","class":"first-page",disabledClass:"no-page",isEnabled:function(){return this.currentPage>this.firstPage}},prev:{label:"<","class":"prev-page",disabledClass:"no-page",isEnabled:function(){return this.currentPage>this.firstPage}},next:{label:">","class":"next-page",
disabledClass:"no-page",isEnabled:function(){return this.currentPage<this.lastPage}},last:{label:">>","class":"last-page",disabledClass:"no-page",isEnabled:function(){return this.currentPage<this.lastPage}}}},l.prototype.server_api={page:function(){return this.currentPage},per_page:function(){return this.perPage}},l.prototype.isCurrentPage=function(a){return this.currentPage===a},l.prototype.getMinPage=function(){this._minPage=this.currentPage-(this.pagesInRange||this.DefaultPagesInRange);this._minPage<
this.firstPage&&(this._minPage=this.firstPage);return this._minPage},l.prototype.getMaxPage=function(){this._maxPage=this.currentPage+(this.pagesInRange||this.DefaultPagesInRange);this._maxPage>this.lastPage&&(this._maxPage=this.lastPage);return this._maxPage},l.prototype.getDisplayPages=function(){var a,b;return function(){b=[];for(var c=a=this.getMinPage(),e=this.getMaxPage();a<=e?c<=e:c>=e;a<=e?c++:c--)b.push(c);return b}.apply(this)},l.prototype.getPageNumberLink=function(a){return'<li class="'+
this.getPageNumberLinkClass(a)+'" data-value="'+a+'"><a href="#">'+a+"</a></li>"},l.prototype.getPageNumberLinkClass=function(a){return""+this.pageLinks.defaultClass+" "+this.pageLinks.numberedPageOptions["class"]+" "+this.getExtraClassFor(a)},l.prototype.getExtraClassFor=function(a){return this.isCurrentPage(a)?this.pageLinks.numberedPageOptions.selectedClass:this.pageLinks.numberedPageOptions.unselectedClass},l.prototype.getPageControl=function(a){return'<li class="'+this.getPageControlClass(a)+
'"><a href="#">'+this.pageLinks[a].label+"</a></li>"},l.prototype.getPageControlClass=function(a){return this.pageLinks[a].isEnabled.apply(this)?this.getEnabledPageControlClass(a):this.getDisabledPageControlClass(a)},l.prototype.getEnabledPageControlClass=function(a){return""+this.pageLinks.defaultClass+" "+this.pageLinks[a]["class"]},l.prototype.getDisabledPageControlClass=function(a){return""+this.pageLinks.defaultClass+" "+this.pageLinks.disabledClass+" "+this.pageLinks[a].disabledClass},l.prototype.parse=
function(a){this.paginator_ui.count=a.count;this.lastPage=this.availablePages=Math.ceil(a.count/this.perPage);return a.results},l.prototype.getPager=function(){return 1>=this.lastPage?"":"<"+this.pageLinks.wrapperTag+">"+this.getPageControl("first")+this.getPageControl("prev")+_.map(this.getDisplayPages(),this.getPageNumberLink,this).join("")+this.getPageControl("next")+this.getPageControl("last")+("</"+this.pageLinks.wrapperTag+">")});k.Collection=l;Sharkbone.Modules.Relational={setupRelations:function(){var a=
this;if(null!=this.relations)return _.each(this.relations,function(b){return a.get(b.key).url=""+a.urlRoot.unslash()+"/"+a.get("id")+"/"+b.key})},fetchCollections:function(){var a=this;return this.isNew()?!1:_(this.relations).chain().filter(function(a){return a.type===Backbone.HasMany}).pluck("key").each(function(b){return a.get(b).fetch()}).value()},createDotSyntaxCollectionGetters:function(){var a=this;return _(this.relations).chain().pluck("key").each(function(b){return a[b]=function(){return this.get(b)}})},
toJSON:function(){var a;return null!=Sharkbone.Config.ActiveRecord&&Sharkbone.Config.ActiveRecord?(a=_(this.attributes).clone(),_(this.relations).each(function(b){0<a[b.key].length&&(a[""+b.key+"_attributes"]=_(a[b.key]).clone());return delete a[b.key]}),a):Backbone.Model.prototype.toJSON.apply(this,arguments)}};Sharkbone.ClassModules.Relational={hasMany:function(a,b){null==b&&(b={});if(!a)throw Error("HasMany relations require a key");this.prototype.relations=this.prototype.relations||[];_.extend(b,
{type:Backbone.HasMany,key:a});_.defaults(b,{relatedModel:""+this.appNamespace()+"Models."+_.singularize(a).camelize(),collectionType:""+this.appNamespace()+"Collections."+_.pluralize(a).camelize()});return this.prototype.relations.push(b)},hasOne:function(a,b){null==b&&(b={});if(!a)throw Error("HasOne relations require a key");this.prototype.relations=this.prototype.relations||[];_.extend(b,{type:Backbone.HasOne,key:a});_.defaults(b,{relatedModel:""+this.appNamespace()+"Models."+_.singularize(a).camelize()});
return this.prototype.relations.push(b)}};var k=Sharkbone,c=function(){c.__super__.constructor.apply(this,arguments)};b(c,Backbone.RelationalModel||Backbone.Model);_.extend(c,Sharkbone.Mixin);c.extend(Sharkbone.Shared);c.prototype.initialize=function(){var a=this;c.__super__.initialize.apply(this,arguments);if(null!=Backbone.RelationalModel)this.on("change:id",function(){return a.setupRelations.apply(a)});"function"===typeof this.setupRelations&&this.setupRelations();return"function"===typeof this.fetchCollections?
this.fetchCollections():void 0};null!=Backbone.RelationalModel&&(c.include(Sharkbone.Modules.Relational),c.extend(Sharkbone.ClassModules.Relational));k.Model=c;Sharkbone.Modules.CUD={create:function(a){var b=this;null==a&&(a={});"function"===typeof a.preventDefault&&a.preventDefault();"function"===typeof a.stopPropagation&&a.stopPropagation();return this.collection.create(this.model,{success:function(){return b.runCallbacksFor(b._afterSuccessfulCreate,b.model)},error:function(){return b.runCallbacksFor(b._afterFailingCreate,
b.model)}})},update:function(a){var b=this;null==a&&(a={});"function"===typeof a.preventDefault&&a.preventDefault();"function"===typeof a.stopPropagation&&a.stopPropagation();return this.model.save(void 0,{success:function(){return b.runCallbacksFor(b._afterSuccessfulUpdate,b.model)},error:function(){return b.runCallbacksFor(b._afterFailingUpdate,b.model)}})},destroy:function(a,b){var c,e=this;null==a&&(a={});null==b&&(b={});"function"===typeof a.preventDefault&&a.preventDefault();"function"===typeof a.stopPropagation&&
a.stopPropagation();if(!this.__destroyConfirmation())return this.model;if(null!=a&&null!=this.collection&&(c=this.collection.get(a)))return c.destroy({success:function(){return e.runCallbacksFor(e._afterSuccessfulDestroy,e.model)},error:function(){return e.runCallbacksFor(e._afterFailingDestroy,e.model)}}),this.collection.remove(this.collection.get(a));if(null!=this.model)return this.model.destroy({success:function(){return e.runCallbacksFor(e._afterSuccessfulDestroy,e.model)},error:function(){return e.runCallbacksFor(e._afterFailingDestroy,
e.model)}});throw Error("Missing reference for destroying an object, forgot to supply an ID?");},runCallbacksFor:function(){return"function"===typeof this.callbacksFor?this.callbacksFor.apply(this,arguments):void 0},destroyConfirmation:function(a){this.__destroyConfirmation="function"===typeof a?a:function(){return a};return this},__destroyConfirmation:function(){return confirm("This is a destructive operation and it cannot be undone. Confirm?")}};Sharkbone.Modules.CUDCallbacks={_afterSuccessfulCreate:[],
_afterSuccessfulUpdate:[],_afterSuccessfulDestroy:[],_afterFailingCreate:[],_afterFailingUpdate:[],_afterFailingDestroy:[],initializeDefaultCallbacks:function(){this.afterCreate(this.remove);this.afterCreate(this.goToShow);this.afterUpdate(this.remove);this.afterUpdate(this.goToShow);this.afterDestroy(this.goToIndex);return this},initializeCudContainers:function(){this._afterSuccessfulCreate=[];this._afterSuccessfulUpdate=[];this._afterSuccessfulDestroy=[];this._afterFailingCreate=[];this._afterFailingUpdate=
[];return this._afterFailingDestroy=[]},callbacksFor:function(a,b){var c=this;_(a).each(function(a){return a.apply(c,b)});return this},afterCreate:function(){return this.registerCallbacks.call(this,this._afterSuccessfulCreate,arguments)},afterUpdate:function(){return this.registerCallbacks.call(this,this._afterSuccessfulUpdate,arguments)},afterDestroy:function(){return this.registerCallbacks.call(this,this._afterSuccessfulDestroy,arguments)},afterFailingCreate:function(){return this.registerCallbacks.call(this,
this._afterFailingCreate,arguments)},afterFailingUpdate:function(){return this.registerCallbacks.call(this,this._afterFailingUpdate,arguments)},afterFailingDestroy:function(){return this.registerCallbacks.call(this,this._afterFailingDestroy,arguments)},registerCallbacks:function(a,b){var c=this;return _(Array.prototype.slice.call(b)).each(function(b){return c.registerCallback(a,b)})},registerCallback:function(a,b){if("function"===typeof b)return a.push(b)}};k=Sharkbone.Modules;e=function(){};e.prototype.requestPreviousPage=
function(a){a.preventDefault();a.stopPropagation();return this.collection.goTo(this.collection.paginator_ui.currentPage-=1)};e.prototype.requestNextPage=function(a){a.preventDefault();a.stopPropagation();return this.collection.goTo(this.collection.paginator_ui.currentPage+=1)};e.prototype.goToPage=function(a){a.preventDefault();a.stopPropagation();return this.collection.goTo(this.collection.paginator_ui.currentPage=parseInt($(a.currentTarget).attr("data-value")))};e.prototype.goToFirst=function(a){a.preventDefault();
a.stopPropagation();return this.collection.goTo(this.collection.paginator_ui.currentPage=this.collection.firstPage)};e.prototype.goToLast=function(a){a.preventDefault();a.stopPropagation();return this.collection.goTo(this.collection.paginator_ui.currentPage=this.collection.lastPage)};e.prototype.noPage=function(a){a.preventDefault();return a.stopPropagation()};k.PaginationControls=e;k=Sharkbone.Modules;e=function(){};e.prototype.paginatorSelector=".pagination";e.prototype.render=function(){this.$el.html("");
return this};e.prototype.renderData=function(a,b){this.$el.append(a(b));return this};e.prototype.renderResource=function(a,b){this.$el.append(a());this.modelBinder.bind(b,this.el,this.bindings());return this};e.prototype.renderCollection=function(a,b,c){this.$el.append(a());this.collectionBinder.bind(b,this.$(c));return this};e.prototype.renderPagination=function(){$(this.paginatorSelector).html(this.collection.getPager());return this};k.Render=e;var k=Sharkbone,m=function(){m.__super__.constructor.apply(this,
arguments)};b(m,Backbone.View);_.extend(m,Sharkbone.Mixin);m.include(Sharkbone.ViewManager);m.include(Sharkbone.Modules.CUD);m.include(Sharkbone.Modules.CUDCallbacks);m.include(Sharkbone.Modules.Render);m.include(Sharkbone.Modules.PaginationControls);m.prototype.initialize=function(){m.__super__.initialize.apply(this,arguments);_.bindAll(this);this.initializePaginatedCollection();this.initializeModelBinding();"function"===typeof this.initializeCudContainers&&this.initializeCudContainers();return this};
m.prototype.initializePaginatedCollection=function(){null!=this.collection&&_.isFunction(this.collection.getPager)&&this.listenTo(this.collection,"reset",this.renderPagination);return this};m.prototype.initializeModelBinding=function(){null!=Backbone.ModelBinder&&(this.modelBinder=new Backbone.ModelBinder);return this};m.prototype.buildCollectionBinder=function(a,b){return new Backbone.CollectionBinder(new Backbone.CollectionBinder.ElManagerFactory(a(),b()))};m.prototype.bindings=function(){throw Error("You must define the bindings method in your view!");
};m.prototype.events={"click .close-self":"close","click .first-page":"goToFirst","click .prev-page":"requestPreviousPage","click .next-page":"requestNextPage","click .last-page":"goToLast","click .page-marker":"goToPage","click .no-page":"noPage","click a.show_detail":function(a){return a.stopPropagation()},"click a.edit":function(a){return a.stopPropagation()}};m.prototype.close=function(a){a.preventDefault();this.remove();return this.goToIndex()};m.prototype.remove=function(){null!=this.modelBinder&&
this.modelBinder.unbind();null!=this.collectionBinder&&this.collectionBinder.unbind();return this.$el.remove()};k.View=m}).call(this);